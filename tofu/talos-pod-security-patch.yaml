# Talos Machine Config Patch for Pod Security Admission
# Adds monitoring namespace to exemptions list
cluster:
  apiServer:
    admissionControl:
      - name: PodSecurity
        configuration:
          apiVersion: pod-security.admission.config.k8s.io/v1alpha1
          kind: PodSecurityConfiguration
          defaults:
            enforce: "baseline"
            enforce-version: "latest"
            audit: "restricted"
            audit-version: "latest"
            warn: "restricted"
            warn-version: "latest"
          exemptions:
            usernames: []
            runtimeClasses: []
            namespaces:
              - kube-system
              - monitoring        # Add monitoring namespace to exemptions
              - rook-ceph        # Add rook-ceph for storage
              - longhorn-system  # If using Longhorn storage
              - cilium           # For Cilium CNI if in separate namespace