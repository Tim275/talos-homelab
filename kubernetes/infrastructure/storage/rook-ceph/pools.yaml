# Enterprise RBD Pool - High Performance with 3x Replication
apiVersion: ceph.rook.io/v1
kind: CephBlockPool
metadata:
  name: replicapool-enterprise
  namespace: rook-ceph
  annotations:
    argocd.argoproj.io/sync-wave: "3"
spec:
  failureDomain: host
  replicated:
    size: 3
    requireSafeReplicaSize: true
  parameters:
    min_size: "2"
    pg_num: "32"
    pgp_num: "32"
    # Optimized for enterprise workloads
    compression_algorithm: "lz4"
    compression_mode: "aggressive"
    compression_required_ratio: "0.875"
    compression_max_blob_size: "131072"
    compression_min_blob_size: "8192"
  # Enable mirroring for disaster recovery
  mirroring:
    enabled: false
    mode: image

# ============================================================
# DISABLED POOLS - Unused, saves resources (MDS, extra pools)
# Re-enable by uncommenting if needed
# ============================================================

# ---
# # SSD Pool - Ultra High Performance (DISABLED - no SSD tier in use)
# apiVersion: ceph.rook.io/v1
# kind: CephBlockPool
# metadata:
#   name: ssd-pool
#   namespace: rook-ceph
#   annotations:
#     argocd.argoproj.io/sync-wave: "3"
# spec:
#   failureDomain: host
#   replicated:
#     size: 3
#     requireSafeReplicaSize: true
#   parameters:
#     min_size: "2"
#     pg_num: "32"
#     pgp_num: "32"
#     compression_mode: "none"
#   mirroring:
#     enabled: false

---
# CephFS Filesystem for Shared Storage (GitLab, shared data)
apiVersion: ceph.rook.io/v1
kind: CephFilesystem
metadata:
  name: myfs-enterprise
  namespace: rook-ceph
  annotations:
    argocd.argoproj.io/sync-wave: "3"
spec:
  metadataPool:
    failureDomain: host
    replicated:
      size: 3
      requireSafeReplicaSize: true
    parameters:
      pg_num: "32"
      pgp_num: "32"
      min_size: "2"
  dataPools:
    - name: replicated
      failureDomain: host
      replicated:
        size: 3
        requireSafeReplicaSize: true
      parameters:
        pg_num: "32"
        pgp_num: "32"
        min_size: "2"
        compression_algorithm: "lz4"
        compression_mode: "aggressive"
  preserveFilesystemOnDelete: false
  metadataServer:
    activeCount: 1
    activeStandby: false  # Homelab: No standby to save RAM
    priorityClassName: system-cluster-critical
    resources:
      limits:
        cpu: "500m"
        memory: "1Gi"
      requests:
        cpu: "100m"
        memory: "512Mi"
