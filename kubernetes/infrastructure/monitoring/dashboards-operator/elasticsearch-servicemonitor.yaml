# Elasticsearch ServiceMonitor - Search Engine Cluster Monitoring
# Monitors Elasticsearch cluster and related components

# Elasticsearch Cluster ServiceMonitor
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: elasticsearch-cluster
  namespace: elastic-system
  labels:
    app.kubernetes.io/name: elasticsearch
    app.kubernetes.io/component: cluster
    release: prometheus-operator
spec:
  selector:
    matchLabels:
      app: elasticsearch-master
  endpoints:
  - port: http
    interval: 30s
    path: /_prometheus/metrics
    honorLabels: true
  - port: http
    interval: 30s
    path: /_cluster/health
    honorLabels: true
  namespaceSelector:
    matchNames:
    - elastic-system

---
# Elasticsearch Exporter ServiceMonitor
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: elasticsearch-exporter
  namespace: elastic-system
  labels:
    app.kubernetes.io/name: elasticsearch-exporter
    app.kubernetes.io/component: exporter
    release: prometheus-operator
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: elasticsearch-exporter
  endpoints:
  - port: http
    interval: 30s
    path: /metrics
    honorLabels: true
  namespaceSelector:
    matchNames:
    - elastic-system

---
# Kibana ServiceMonitor
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: kibana
  namespace: elastic-system
  labels:
    app.kubernetes.io/name: kibana
    app.kubernetes.io/component: visualization
    release: prometheus-operator
spec:
  selector:
    matchLabels:
      app: kibana
  endpoints:
  - port: http
    interval: 30s
    path: /api/status
    honorLabels: true
  namespaceSelector:
    matchNames:
    - elastic-system

---
# Logstash ServiceMonitor
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: logstash
  namespace: elastic-system
  labels:
    app.kubernetes.io/name: logstash
    app.kubernetes.io/component: pipeline
    release: prometheus-operator
spec:
  selector:
    matchLabels:
      app: logstash
  endpoints:
  - port: http
    interval: 30s
    path: /_node/stats
    honorLabels: true
  - port: monitoring
    interval: 30s
    path: /metrics
    honorLabels: true
  namespaceSelector:
    matchNames:
    - elastic-system
