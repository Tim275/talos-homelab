# Kafka ServiceMonitor - Complete Kafka Platform Monitoring
# Monitors Kafka brokers, Strimzi operator, and Schema Registry

# Kafka Brokers ServiceMonitor
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: kafka-brokers
  namespace: kafka
  labels:
    app.kubernetes.io/name: kafka
    app.kubernetes.io/component: broker
    release: prometheus-operator
spec:
  selector:
    matchLabels:
      strimzi.io/cluster: my-cluster
      strimzi.io/kind: Kafka
      strimzi.io/name: my-cluster-kafka
  endpoints:
  - port: tcp-prometheus
    interval: 30s
    path: /metrics
    honorLabels: true
  namespaceSelector:
    matchNames:
    - kafka

---
# Strimzi Cluster Operator ServiceMonitor
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: strimzi-cluster-operator
  namespace: kafka
  labels:
    app.kubernetes.io/name: strimzi-cluster-operator
    app.kubernetes.io/component: operator
    release: prometheus-operator
spec:
  selector:
    matchLabels:
      name: strimzi-cluster-operator
  endpoints:
  - port: http
    interval: 30s
    path: /metrics
    honorLabels: true
  namespaceSelector:
    matchNames:
    - kafka

---
# Kafka Exporter ServiceMonitor
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: kafka-exporter
  namespace: kafka
  labels:
    app.kubernetes.io/name: kafka-exporter
    app.kubernetes.io/component: exporter
    release: prometheus-operator
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: kafka-exporter
  endpoints:
  - port: tcp-prometheus
    interval: 30s
    path: /metrics
    honorLabels: true
  namespaceSelector:
    matchNames:
    - kafka

---
# Schema Registry ServiceMonitor
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: schema-registry
  namespace: kafka
  labels:
    app.kubernetes.io/name: schema-registry
    app.kubernetes.io/component: schema-registry
    release: prometheus-operator
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: schema-registry
  endpoints:
  - port: api
    interval: 30s
    path: /metrics
    honorLabels: true
  namespaceSelector:
    matchNames:
    - kafka

---
# Redpanda Console ServiceMonitor
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: redpanda-console
  namespace: kafka
  labels:
    app.kubernetes.io/name: redpanda-console
    app.kubernetes.io/component: ui
    release: prometheus-operator
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: redpanda-console
  endpoints:
  - port: http
    interval: 30s
    path: /metrics
    honorLabels: true
  - port: http
    interval: 30s
    path: /admin/health
    honorLabels: true
  namespaceSelector:
    matchNames:
    - kafka
