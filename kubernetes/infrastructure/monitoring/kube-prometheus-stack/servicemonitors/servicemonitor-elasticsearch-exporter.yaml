# ELASTICSEARCH EXPORTER SERVICEMONITOR - SAME PATTERN AS KAFKA!
# ==================================================================
# Scrapes metrics from the Elasticsearch Exporter (port 9114)
# This gives us cluster health, node stats, indices metrics, and more
#
# WHY EXPORTER APPROACH WORKS:
# - Ceph: Native metrics on /metrics (works directly)
# - Kafka: Kafka Exporter provides metrics on port 9404 (works via exporter)
# - Elasticsearch: Elasticsearch Exporter provides metrics on port 9114 (works via exporter)
#
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: elasticsearch-exporter
  namespace: monitoring
  annotations:
    argocd.argoproj.io/tracking-id: kube-prometheus-stack:monitoring.coreos.com/ServiceMonitor:monitoring/elasticsearch-exporter
  labels:
    argocd.argoproj.io/instance: kube-prometheus-stack
    app: elasticsearch-exporter
    release: kube-prometheus-stack  # CRITICAL for Prometheus discovery
spec:
  namespaceSelector:
    matchNames:
      - elastic-system
  selector:
    matchLabels:
      app: elasticsearch-exporter     # Matches our exporter service
      component: metrics-exporter     # Additional selector
  endpoints:
    - port: metrics                   # Port name from exporter service (9114)
      interval: 30s                   # Scrape every 30 seconds
      path: /metrics                  # Standard Prometheus metrics path
      scheme: http                    # Exporter uses HTTP not HTTPS
