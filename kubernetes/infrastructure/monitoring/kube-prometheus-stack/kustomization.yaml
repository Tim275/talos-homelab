apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization


resources:
  - ns.yaml
  - alertmanager-slack-webhooks-sealed-secret.yaml  # Slack webhook for #alerts channel
  - layer1-infrastructure-alerts.yaml
  - layer2-security-alerts.yaml
  - layer3-network-alerts.yaml
  - layer4-storage-alerts.yaml
  - layer5-platform-alerts.yaml
  - argocd-alerts.yaml
  - argocd-enhanced-alerts.yaml  # ArgoCD: Git failures, webhooks, API errors, drift detection
  - velero-backup-alerts.yaml  # Tier-0 Backup Monitoring
  - cnpg-postgresql-alerts.yaml  # CloudNativePG production alerts

  # ===== SERVICEMONITORS - Infrastructure Monitoring =====
  - servicemonitors/servicemonitor-grafana.yaml              # Grafana UI metrics
  - servicemonitors/servicemonitor-cert-manager.yaml         # SSL certificate health
  - servicemonitors/servicemonitor-sealed-secrets.yaml       # Sealed Secrets controller
  # ArgoCD: Controller, API Server, Repo Server, ApplicationSet
  - servicemonitors/argocd-complete.yaml

  # ===== SERVICEMONITORS - Network & Service Mesh =====
  - servicemonitors/servicemonitor-istio-istiod.yaml         # Istio control plane metrics (istiod)
  - servicemonitors/servicemonitor-envoy-gateway.yaml        # Envoy Gateway metrics

  # ===== SERVICEMONITORS - Storage =====
  - servicemonitors/servicemonitor-ceph.yaml                 # Ceph cluster health
  - servicemonitors/servicemonitor-ceph-exporter.yaml        # Ceph exporter metrics

  # ===== SERVICEMONITORS - Observability =====
  - servicemonitors/servicemonitor-elasticsearch-exporter.yaml  # Elasticsearch health
  - servicemonitors/vector-agent.yaml                           # Vector logging agent
  - servicemonitors/vector-aggregator.yaml                      # Vector aggregator
  - servicemonitors/loki.yaml                                   # Loki logging
  - servicemonitors/jaeger.yaml                                 # Jaeger tracing

  # ===== SERVICEMONITORS - Messaging =====
  - servicemonitors/servicemonitor-kafka-exporter.yaml          # Kafka metrics

  # ===== SERVICEMONITORS - Databases =====
  - servicemonitors/cnpg-clusters.yaml                          # PostgreSQL cluster metrics

  # ===== SERVICEMONITORS - Applications =====
  - servicemonitors/servicemonitor-n8n-dev.yaml                 # N8N dev environment
  - servicemonitors/servicemonitor-n8n-prod.yaml                # N8N prod environment

helmCharts:
  - name: kube-prometheus-stack
    repo: https://prometheus-community.github.io/helm-charts
    includeCRDs: false  # CRDs already installed - prevents ArgoCD annotation size limit errors
    namespace: monitoring
    version: 75.15.1
    releaseName: kube-prometheus-stack
    valuesFile: ./values.yaml
