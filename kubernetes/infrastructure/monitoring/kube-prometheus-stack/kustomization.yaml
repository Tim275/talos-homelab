apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# : Parent manages namespaces, children inherit
# Namespace managed by: monitoring/namespace.yaml (parent app)
namespace: monitoring

resources:
  # - alertmanager-slack-webhooks-sealed-secret.yaml  # Slack webhook for #alerts channel (DISABLED: Using PagerDuty instead)
  - telegram-bot-sealed.yaml  # Telegram bot token for mobile alerts (@Timour_homelab_bot)

  # =====================================================================
  # ALERTS - Enterprise Layer Architecture
  # =====================================================================

  # ===== P1 CRITICAL =====
  - alerts/p1-critical/enterprise-critical-alerts.yaml

  # ===== LAYER 1: Infrastructure =====
  - alerts/layer1-infrastructure/layer1-infrastructure-alerts.yaml
  - alerts/layer1-infrastructure/talos-os-alerts.yaml
  - alerts/layer1-infrastructure/node-allocation-alerts.yaml

  # ===== LAYER 2: Security =====
  - alerts/layer2-security/layer2-security-alerts.yaml
  - alerts/layer2-security/cert-manager-alerts.yaml

  # ===== LAYER 3: Network =====
  - alerts/layer3-network/layer3-network-alerts.yaml
  - alerts/layer3-network/grafana-cloudflared-alerts.yaml

  # ===== LAYER 4: Storage =====
  - alerts/layer4-storage/layer4-storage-alerts.yaml
  - alerts/layer4-storage/ceph-cluster-alerts.yaml
  - alerts/layer4-storage/velero-backup-alerts.yaml

  # ===== LAYER 5: Platform =====
  - alerts/layer5-platform/layer5-platform-alerts.yaml
  - alerts/layer5-platform/kafka-alerts.yaml
  - alerts/layer5-platform/cnpg-postgresql-alerts.yaml
  - alerts/layer5-platform/redis-alerts.yaml
  - alerts/layer5-platform/rabbitmq-alerts.yaml
  - alerts/layer5-platform/mongodb-alerts.yaml
  - alerts/layer5-platform/loki-alerts.yaml
  - alerts/layer5-platform/keycloak-alerts.yaml
  - alerts/layer5-platform/argocd-alerts.yaml
  - alerts/layer5-platform/argocd-enhanced-alerts.yaml

  # ===== LAYER 6: Applications =====
  - alerts/layer6-applications/kubernetes-workload-alerts.yaml
  - alerts/layer6-applications/enterprise-workload-alerts.yaml
  - alerts/layer6-applications/n8n-application-alerts.yaml
  - alerts/layer6-applications/kafka-saga-application-alerts.yaml
  - alerts/layer6-applications/basic-tier0-alerts.yaml

  # ===== SLO/SLI =====
  - alerts/slo-sli/slo-sli-alerts.yaml

  # ===== SELF-MONITORING =====
  - alerts/self-monitoring/prometheus-self-monitoring-alerts.yaml

  # =====================================================================
  # SERVICEMONITORS - Infrastructure Monitoring
  # =====================================================================
  - servicemonitors/servicemonitor-grafana.yaml
  - servicemonitors/servicemonitor-grafana-operator.yaml
  - servicemonitors/servicemonitor-cert-manager.yaml
  - servicemonitors/argocd-complete.yaml

  # ===== SERVICEMONITORS - Network & Service Mesh =====
  - servicemonitors/servicemonitor-istio-istiod.yaml
  - servicemonitors/servicemonitor-envoy-gateway.yaml

  # ===== SERVICEMONITORS - Storage =====
  - servicemonitors/servicemonitor-ceph.yaml
  - servicemonitors/servicemonitor-ceph-exporter.yaml

  # ===== SERVICEMONITORS - Observability =====
  - servicemonitors/servicemonitor-elasticsearch-exporter.yaml
  - servicemonitors/servicemonitor-elasticsearch-cluster.yaml
  - servicemonitors/vector-agent.yaml
  - servicemonitors/vector-aggregator.yaml
  - servicemonitors/servicemonitor-vector.yaml
  - servicemonitors/jaeger.yaml
  - servicemonitors/servicemonitor-influxdb.yaml
  - servicemonitors/servicemonitor-opentelemetry-collector.yaml

  # ===== SERVICEMONITORS - Messaging =====
  - servicemonitors/servicemonitor-kafka-exporter.yaml
  - servicemonitors/servicemonitor-schema-registry.yaml
  - servicemonitors/servicemonitor-rabbitmq.yaml
  - servicemonitors/servicemonitor-kafka-saga.yaml

  # ===== SERVICEMONITORS - Databases =====
  - servicemonitors/cnpg-clusters.yaml
  - servicemonitors/servicemonitor-mongodb.yaml

  # ===== SERVICEMONITORS - Applications =====
  - servicemonitors/servicemonitor-n8n-dev.yaml
  - servicemonitors/servicemonitor-n8n-prod.yaml

helmCharts:
  - name: kube-prometheus-stack
    repo: https://prometheus-community.github.io/helm-charts
    includeCRDs: true  # CRDs required for PrometheusRule resources
    namespace: monitoring
    version: 75.18.1
    releaseName: kube-prometheus-stack
    valuesFile: ./values.yaml
