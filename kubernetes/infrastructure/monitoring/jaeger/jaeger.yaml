apiVersion: jaegertracing.io/v1
kind: Jaeger
metadata:
  name: jaeger
  namespace: jaeger-system
  annotations:
    # Disable Prometheus auto-discovery for non-metrics endpoints
    prometheus.io/scrape: "false"
spec:
  strategy: allinone
  storage:
    type: memory

  # Disable automatic scraping for pods that don't have proper metrics endpoints
  annotations:
    prometheus.io/scrape: "false"

  # ðŸ”„ HYBRID SETUP: Support both OTLP and Jaeger Agent flows
  collector:
    maxReplicas: 1
    resources:
      requests:
        memory: 128Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 500m
    options:
      # âœ… OTLP Protocol (Modern apps)
      collector.otlp.enabled: true
      collector.otlp.grpc.host-port: ":14250"
      collector.otlp.http.host-port: ":14268"

      # âœ… Jaeger Protocol (Legacy apps)
      collector.jaeger.grpc.host-port: ":14250"
      collector.jaeger.http.host-port: ":14268"

  query:
    replicas: 1
    resources:
      requests:
        memory: 128Mi
        cpu: 100m
      limits:
        memory: 256Mi
        cpu: 300m

  # ðŸš€ AGENT AS SERVICE: No hostPort, Pod Security baseline compatible
  agent:
    strategy: Deployment  # Service instead of DaemonSet
    replicas: 2
    options:
      # Agent sends to collector via service discovery
      reporter.grpc.host-port: "jaeger-collector:14250"
    resources:
      requests:
        memory: 64Mi
        cpu: 50m
      limits:
        memory: 128Mi
        cpu: 200m