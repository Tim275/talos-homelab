# üî∏ ConfigMaps with Dashboard JSON (Vegarn Style)
apiVersion: v1
kind: ConfigMap
metadata:
  name: cilium-dashboard
  namespace: kube-system
  labels:
    app.kubernetes.io/name: cilium
    app.kubernetes.io/component: dashboards
    team: platform
data:
  cilium-dashboard.json: |
    {
      "id": null,
      "title": "Cilium Agent Metrics",
      "tags": ["cilium", "agent", "cni"],
      "style": "dark",
      "timezone": "browser",
      "refresh": "30s",
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "panels": [
        {
          "id": 1,
          "title": "Cilium Agent Status",
          "type": "stat",
          "gridPos": {"h": 4, "w": 8, "x": 0, "y": 0},
          "targets": [
            {
              "expr": "up{job=\"cilium-agent\"}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "mappings": [
                {"options": {"0": {"text": "DOWN", "color": "red"}}, "type": "value"},
                {"options": {"1": {"text": "UP", "color": "green"}}, "type": "value"}
              ]
            }
          },
          "options": {
            "colorMode": "background"
          }
        },
        {
          "id": 2,
          "title": "BPF Map Operations",
          "type": "timeseries",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
          "targets": [
            {
              "expr": "rate(cilium_bpf_map_ops_total[5m])",
              "legendFormat": "{{map_name}} - {{operation}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "ops"
            }
          }
        },
        {
          "id": 3,
          "title": "Endpoints Managed",
          "type": "stat",
          "gridPos": {"h": 4, "w": 8, "x": 8, "y": 0},
          "targets": [
            {
              "expr": "cilium_endpoint_count",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "displayName": "Total Endpoints"
            }
          }
        }
      ],
      "version": 1
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cilium-operator-dashboard
  namespace: kube-system
  labels:
    app.kubernetes.io/name: cilium-operator
    app.kubernetes.io/component: dashboards
    team: platform
data:
  cilium-operator-dashboard.json: |
    {
      "id": null,
      "title": "Cilium Operator",
      "tags": ["cilium", "operator", "cluster"],
      "style": "dark",
      "timezone": "browser",
      "refresh": "30s",
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "panels": [
        {
          "id": 1,
          "title": "Operator Status",
          "type": "stat",
          "gridPos": {"h": 4, "w": 8, "x": 0, "y": 0},
          "targets": [
            {
              "expr": "up{job=\"cilium-operator\"}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "mappings": [
                {"options": {"0": {"text": "DOWN", "color": "red"}}, "type": "value"},
                {"options": {"1": {"text": "UP", "color": "green"}}, "type": "value"}
              ]
            }
          },
          "options": {
            "colorMode": "background"
          }
        },
        {
          "id": 2,
          "title": "Identity Allocations",
          "type": "timeseries",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
          "targets": [
            {
              "expr": "cilium_identity_count",
              "legendFormat": "Total Identities",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short"
            }
          }
        }
      ],
      "version": 1
    }
---
# üéØ GrafanaDashboard CRDs (Vegarn Style with configMapRef)
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: cilium
  namespace: kube-system
  labels:
    app.kubernetes.io/name: cilium
    app.kubernetes.io/component: dashboards
    team: platform
  annotations:
    argocd.argoproj.io/sync-wave: "7"
spec:
  allowCrossNamespaceImport: true
  folder: Cilium
  resyncPeriod: 10m
  instanceSelector:
    matchLabels:
      app: grafana  # ‚ö†Ô∏è Must match our Grafana instance
  configMapRef:
    name: cilium-dashboard
    key: cilium-dashboard.json
---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: operator
  namespace: kube-system
  labels:
    app.kubernetes.io/name: cilium-operator
    app.kubernetes.io/component: dashboards
    team: platform
  annotations:
    argocd.argoproj.io/sync-wave: "7"
spec:
  allowCrossNamespaceImport: true
  folder: Cilium
  resyncPeriod: 10m
  instanceSelector:
    matchLabels:
      app: grafana  # ‚ö†Ô∏è Must match our Grafana instance
  configMapRef:
    name: cilium-operator-dashboard
    key: cilium-operator-dashboard.json
