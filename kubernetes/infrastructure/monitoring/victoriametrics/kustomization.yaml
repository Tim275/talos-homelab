apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# 🚀 VictoriaMetrics - Drop-in Prometheus Replacement
# Better performance, less resource usage, same PromQL compatibility

commonAnnotations:
  argocd.argoproj.io/sync-wave: "3"  # After prometheus-operator-crds

resources:
  # 🎯 OPERATOR DEPLOYMENT (Helm Chart via Application - processed by ArgoCD directly)
  - application.yaml          # ✅ VictoriaMetrics Operator Helm chart

  # 🏗️ CLUSTER COMPONENTS (Raw YAML - processed by Kustomize)
  - vmcluster.yaml            # VM Cluster (storage + select + insert)
  - vmagent.yaml              # VM Agent (scrapes ServiceMonitors)

  # 🔍 SCRAPE TARGETS (VMServiceScrapes for VictoriaMetrics)
  - elasticsearch-vmservicescrape.yaml    # Elasticsearch metrics scraping
  - argocd-server-vmservicescrape.yaml    # ArgoCD Server metrics scraping
  - argocd-controller-vmservicescrape.yaml # ArgoCD Controller metrics scraping
  - argocd-redis-vmservicescrape.yaml     # ArgoCD Redis metrics scraping
  - rook-ceph-vmservicescrape.yaml        # Rook-Ceph manager metrics scraping

  # 📊 GRAFANA INTEGRATION (Raw YAML - processed by Kustomize)
  - grafana-datasource.yaml   # ✅ ENABLED: VictoriaMetrics as primary datasource

# 🎛️ COMMON LABELS
commonLabels:
  app.kubernetes.io/part-of: victoriametrics
  app.kubernetes.io/managed-by: argocd
