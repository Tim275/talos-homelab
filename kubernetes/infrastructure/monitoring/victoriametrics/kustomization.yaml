apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization


# VictoriaMetrics - Drop-in Prometheus Replacement
# Better performance, less resource usage, same PromQL compatibility

commonAnnotations:
  argocd.argoproj.io/sync-wave: "3"  # After prometheus-operator-crds

resources:
  # OPERATOR DEPLOYMENT (Helm Chart via Application - processed by ArgoCD directly)

  # CLUSTER COMPONENTS (Raw YAML - processed by Kustomize)
  - vmcluster.yaml            # VM Cluster (storage + select + insert)
  - vmagent.yaml              # VM Agent (scrapes ServiceMonitors)

  # SCRAPE TARGETS - VMServiceScrapes moved to target namespaces
  # Note: VMServiceScrapes now deployed directly in their target namespaces
  # for proper service discovery. ArgoCD deploys them via namespace-specific
  # applications or they are applied directly via kubectl.

  # Self-monitoring targets (remain in monitoring namespace)
  - monitoring-stack-vmservicescrape.yaml # Self-monitoring (Grafana, Loki, AlertManager)
  - kubelet-vmservicescrape.yaml           # Kubelet node metrics (cross-namespace scraping)

  # VMPodScrapes and direct scrapes
  - strimzi-operator-vmpodscrape.yaml     # Strimzi Kafka Operator metrics (VMPodScrape)

  # GRAFANA INTEGRATION (Raw YAML - processed by Kustomize)
  - grafana-datasource.yaml   # ENABLED: VictoriaMetrics as primary datasource

  # CENTRALIZED SERVICE ANNOTATIONS (Target services for monitoring)
  - service-annotations.yaml  # Service-level prometheus.io annotations

# COMMON LABELS
commonLabels:
  app.kubernetes.io/part-of: victoriametrics
  app.kubernetes.io/managed-by: argocd
