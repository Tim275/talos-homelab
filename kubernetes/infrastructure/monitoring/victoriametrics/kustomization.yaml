apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# ğŸš€ VictoriaMetrics - Drop-in Prometheus Replacement
# Better performance, less resource usage, same PromQL compatibility

commonAnnotations:
  argocd.argoproj.io/sync-wave: "3"  # After prometheus-operator-crds

resources:
  # ğŸ¯ OPERATOR DEPLOYMENT (Helm Chart via Application - processed by ArgoCD directly)
  - application.yaml          # âœ… VictoriaMetrics Operator Helm chart

  # ğŸ—ï¸ CLUSTER COMPONENTS (Raw YAML - processed by Kustomize)
  - vmcluster.yaml            # VM Cluster (storage + select + insert)
  - vmagent.yaml              # VM Agent (scrapes ServiceMonitors)

  # ğŸ” SCRAPE TARGETS (VMServiceScrapes for VictoriaMetrics)
  # ğŸ“Š DATA & MESSAGING
  - elasticsearch-vmservicescrape.yaml    # Elasticsearch metrics scraping
  - kafka-vmservicescrape.yaml            # Kafka JMX metrics scraping
  - kafka-exporter-vmservicescrape.yaml   # Kafka Exporter metrics scraping

  # ğŸ—ï¸ INFRASTRUCTURE & OPERATORS
  - argocd-server-vmservicescrape.yaml    # ArgoCD Server metrics scraping
  - argocd-controller-vmservicescrape.yaml # ArgoCD Controller metrics scraping
  - argocd-redis-vmservicescrape.yaml     # ArgoCD Redis metrics scraping
  - cert-manager-vmservicescrape.yaml     # Cert-Manager certificate metrics
  - operators-vmservicescrape.yaml        # K8s Operators (Sealed Secrets, CNPG, etc.)

  # ğŸŒ NETWORKING & SERVICE MESH
  - cilium-operator-vmservicescrape.yaml  # Cilium Operator CPU/Memory/IPAM metrics
  - cilium-hubble-vmservicescrape.yaml    # Cilium Agent & Hubble network observability
  - istio-vmservicescrape.yaml            # Istio service mesh (istiod) & Sail Operator
  - strimzi-operator-vmservicescrape.yaml # Strimzi Kafka Operator metrics

  # ğŸ’¾ STORAGE
  - rook-ceph-vmservicescrape.yaml        # Rook-Ceph OSDs metrics scraping
  - rook-ceph-mgr-vmservicescrape.yaml    # Rook-Ceph manager metrics scraping

  # ğŸ“¡ OBSERVABILITY
  - jaeger-vmservicescrape.yaml           # Distributed tracing metrics
  - monitoring-stack-vmservicescrape.yaml # Self-monitoring (Grafana, Loki, AlertManager)

  # âš™ï¸ KUBERNETES CORE
  - kubernetes-system-vmservicescrape.yaml # Core K8s (metrics-server, CoreDNS, kubelet)

  # ğŸ¯ APPLICATION MONITORING (Verified metrics endpoints only)
  - authelia-vmservicescrape.yaml     # Authentication service metrics
  - influxdb-vmservicescrape.yaml     # Time series database metrics
  - velero-vmservicescrape.yaml       # Backup solution metrics
  - postgresql-vmservicescrape.yaml   # Database cluster metrics (CNPG prod)
  - postgresql-dev-vmservicescrape.yaml # Database cluster metrics (CNPG dev)

  # ğŸ“Š GRAFANA INTEGRATION (Raw YAML - processed by Kustomize)
  - grafana-datasource.yaml   # âœ… ENABLED: VictoriaMetrics as primary datasource

# ğŸ›ï¸ COMMON LABELS
commonLabels:
  app.kubernetes.io/part-of: victoriametrics
  app.kubernetes.io/managed-by: argocd
