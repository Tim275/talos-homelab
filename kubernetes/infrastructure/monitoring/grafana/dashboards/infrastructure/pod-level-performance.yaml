apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: pod-level-performance
  namespace: grafana
  labels:
    app.kubernetes.io/part-of: monitoring-stack
    tier: infrastructure
spec:
  allowCrossNamespaceImport: true
  json: |
    {
      "id": null,
      "title": "üîç Pod-Level Performance Analytics",
      "tags": ["kubernetes", "pods", "performance", "troubleshooting"],
      "timezone": "browser",
      "templating": {
        "list": [
          {
            "name": "namespace",
            "type": "query",
            "query": "label_values(kube_pod_info, namespace)",
            "regex": "",
            "sort": 1,
            "multi": true,
            "includeAll": true,
            "allValue": ".*",
            "current": {"text": "All", "value": "$__all"},
            "refresh": "on_time_range_change"
          },
          {
            "name": "pod",
            "type": "query",
            "query": "label_values(kube_pod_info{namespace=~\"$namespace\"}, pod)",
            "regex": "",
            "sort": 1,
            "multi": true,
            "includeAll": true,
            "allValue": ".*",
            "current": {"text": "All", "value": "$__all"},
            "refresh": "on_time_range_change"
          }
        ]
      },
      "panels": [
        {
          "id": 1,
          "title": "Pod-Level Performance Analytics",
          "type": "text",
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 0},
          "options": {
            "content": "<div style=\"text-align: center; font-size: 24px; padding: 20px; background: linear-gradient(90deg, #4338ca, #7c3aed);\">\\n<strong style=\"color: white;\">üîç Pod-Level Performance Analytics</strong>\\n<p style=\"font-size: 16px; color: #e0e7ff; margin-top: 10px;\">Deep Dive ‚Ä¢ Troubleshooting ‚Ä¢ Resource Analysis</p>\\n<p style=\"font-size: 14px; color: #c7d2fe; margin-top: 5px;\">Namespace: <strong>$namespace</strong> | Pod: <strong>$pod</strong></p>\\n</div>"
          }
        },
        {
          "id": 2,
          "title": "Pod Health Summary",
          "type": "stat",
          "targets": [
            {
              "expr": "count(kube_pod_info{namespace=~\"$namespace\", pod=~\"$pod\"})",
              "legendFormat": "Total Pods"
            },
            {
              "expr": "count(kube_pod_status_phase{namespace=~\"$namespace\", pod=~\"$pod\", phase=\"Running\"})",
              "legendFormat": "Running Pods"
            },
            {
              "expr": "count(kube_pod_status_phase{namespace=~\"$namespace\", pod=~\"$pod\", phase=\"Failed\"})",
              "legendFormat": "Failed Pods"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "steps": [
                  {"color": "red", "value": 0},
                  {"color": "green", "value": 1}
                ]
              }
            }
          },
          "gridPos": {"h": 6, "w": 8, "x": 0, "y": 4}
        },
        {
          "id": 3,
          "title": "Resource Limits vs Usage",
          "type": "gauge",
          "targets": [
            {
              "expr": "(sum(container_memory_usage_bytes{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"}) / sum(container_spec_memory_limit_bytes{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"})) * 100",
              "legendFormat": "Memory %"
            },
            {
              "expr": "(sum(rate(container_cpu_usage_seconds_total{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"}[5m])) / sum(container_spec_cpu_limit{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"})) * 100",
              "legendFormat": "CPU %"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 70},
                  {"color": "red", "value": 90}
                ]
              },
              "min": 0,
              "max": 100,
              "unit": "percent"
            }
          },
          "gridPos": {"h": 6, "w": 8, "x": 8, "y": 4}
        },
        {
          "id": 4,
          "title": "Pod Restart Analysis",
          "type": "stat",
          "targets": [
            {
              "expr": "sum(kube_pod_container_status_restarts_total{namespace=~\"$namespace\", pod=~\"$pod\"})",
              "legendFormat": "Total Restarts"
            },
            {
              "expr": "sum(increase(kube_pod_container_status_restarts_total{namespace=~\"$namespace\", pod=~\"$pod\"}[1h]))",
              "legendFormat": "Restarts (1h)"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 1},
                  {"color": "red", "value": 5}
                ]
              }
            }
          },
          "gridPos": {"h": 6, "w": 8, "x": 16, "y": 4}
        },
        {
          "id": 5,
          "title": "CPU Usage by Pod",
          "type": "graph",
          "targets": [
            {
              "expr": "rate(container_cpu_usage_seconds_total{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"}[5m]) * 100",
              "legendFormat": "{{namespace}}/{{pod}}/{{container}}"
            }
          ],
          "yAxes": [
            {"label": "CPU Cores", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 10}
        },
        {
          "id": 6,
          "title": "Memory Usage by Pod",
          "type": "graph",
          "targets": [
            {
              "expr": "container_memory_usage_bytes{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"}",
              "legendFormat": "{{namespace}}/{{pod}}/{{container}} Used"
            },
            {
              "expr": "container_spec_memory_limit_bytes{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"}",
              "legendFormat": "{{namespace}}/{{pod}}/{{container}} Limit"
            }
          ],
          "yAxes": [
            {"label": "Bytes", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 10}
        },
        {
          "id": 7,
          "title": "Network I/O by Pod",
          "type": "graph",
          "targets": [
            {
              "expr": "rate(container_network_receive_bytes_total{namespace=~\"$namespace\", pod=~\"$pod\"}[5m])",
              "legendFormat": "{{namespace}}/{{pod}} RX"
            },
            {
              "expr": "rate(container_network_transmit_bytes_total{namespace=~\"$namespace\", pod=~\"$pod\"}[5m])",
              "legendFormat": "{{namespace}}/{{pod}} TX"
            }
          ],
          "yAxes": [
            {"label": "Bytes/sec", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 18}
        },
        {
          "id": 8,
          "title": "Disk I/O by Pod",
          "type": "graph",
          "targets": [
            {
              "expr": "rate(container_fs_reads_bytes_total{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"}[5m])",
              "legendFormat": "{{namespace}}/{{pod}}/{{container}} Read"
            },
            {
              "expr": "rate(container_fs_writes_bytes_total{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"}[5m])",
              "legendFormat": "{{namespace}}/{{pod}}/{{container}} Write"
            }
          ],
          "yAxes": [
            {"label": "Bytes/sec", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 18}
        },
        {
          "id": 9,
          "title": "Pod Events & Status Changes",
          "type": "logs",
          "targets": [
            {
              "expr": "{namespace=~\"$namespace\", pod=~\"$pod\"} |= \"Event\"",
              "legendFormat": "Pod Events"
            }
          ],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 26}
        },
        {
          "id": 10,
          "title": "Container Resource Requests vs Limits",
          "type": "table",
          "targets": [
            {
              "expr": "kube_pod_container_resource_requests{namespace=~\"$namespace\", pod=~\"$pod\", resource=\"memory\"}",
              "legendFormat": "{{namespace}}/{{pod}}/{{container}} Mem Request"
            },
            {
              "expr": "kube_pod_container_resource_limits{namespace=~\"$namespace\", pod=~\"$pod\", resource=\"memory\"}",
              "legendFormat": "{{namespace}}/{{pod}}/{{container}} Mem Limit"
            },
            {
              "expr": "kube_pod_container_resource_requests{namespace=~\"$namespace\", pod=~\"$pod\", resource=\"cpu\"}",
              "legendFormat": "{{namespace}}/{{pod}}/{{container}} CPU Request"
            },
            {
              "expr": "kube_pod_container_resource_limits{namespace=~\"$namespace\", pod=~\"$pod\", resource=\"cpu\"}",
              "legendFormat": "{{namespace}}/{{pod}}/{{container}} CPU Limit"
            }
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 26}
        },
        {
          "id": 11,
          "title": "Pod Lifecycle & Scheduling",
          "type": "table",
          "targets": [
            {
              "expr": "kube_pod_info{namespace=~\"$namespace\", pod=~\"$pod\"}",
              "legendFormat": "{{namespace}}/{{pod}} on {{node}}"
            },
            {
              "expr": "kube_pod_start_time{namespace=~\"$namespace\", pod=~\"$pod\"}",
              "legendFormat": "{{namespace}}/{{pod}} Start Time"
            },
            {
              "expr": "kube_pod_status_phase{namespace=~\"$namespace\", pod=~\"$pod\"}",
              "legendFormat": "{{namespace}}/{{pod}} Phase: {{phase}}"
            }
          ],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 34}
        },
        {
          "id": 12,
          "title": "Top Resource Consumers",
          "type": "table",
          "targets": [
            {
              "expr": "topk(10, sum by (namespace, pod) (container_memory_usage_bytes{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"}))",
              "legendFormat": "{{namespace}}/{{pod}} Memory Usage"
            },
            {
              "expr": "topk(10, sum by (namespace, pod) (rate(container_cpu_usage_seconds_total{namespace=~\"$namespace\", pod=~\"$pod\", container!=\"POD\"}[5m])))",
              "legendFormat": "{{namespace}}/{{pod}} CPU Usage"
            }
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 34}
        }
      ],
      "time": {"from": "now-1h", "to": "now"},
      "refresh": "30s"
    }
  folder: Kubernetes
  instanceSelector:
    matchLabels:
      app: grafana
  resyncPeriod: 10m
