apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: ceph-pools-detailed
  namespace: grafana
  labels:
    app.kubernetes.io/part-of: monitoring-stack
    tier: storage
spec:
  allowCrossNamespaceImport: true
  instanceSelector:
    matchLabels:
      app: grafana
  json: |
    {
      "id": null,
      "title": "üèä‚Äç‚ôÇÔ∏è Ceph Pools Deep Analysis",
      "tags": ["ceph", "pools", "storage", "analysis"],
      "timezone": "browser",
      "panels": [
        {
          "id": 1,
          "title": "Pool Performance Matrix",
          "type": "table",
          "targets": [
            {
              "expr": "ceph_pool_metadata",
              "legendFormat": "{{pool_name}} | Type: {{pool_type}} | Size: {{size}} | PGs: {{pg_num}}"
            }
          ],
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 0}
        },
        {
          "id": 2,
          "title": "Pool IOPS Comparison",
          "type": "graph",
          "targets": [
            {
              "expr": "rate(ceph_pool_read_total[5m])",
              "legendFormat": "{{pool_name}} Reads"
            },
            {
              "expr": "rate(ceph_pool_write_total[5m])",
              "legendFormat": "{{pool_name}} Writes"
            }
          ],
          "yAxes": [
            {"label": "IOPS", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
        },
        {
          "id": 3,
          "title": "Pool Throughput Comparison",
          "type": "graph",
          "targets": [
            {
              "expr": "rate(ceph_pool_read_bytes_total[5m])",
              "legendFormat": "{{pool_name}} Read MB/s"
            },
            {
              "expr": "rate(ceph_pool_write_bytes_total[5m])",
              "legendFormat": "{{pool_name}} Write MB/s"
            }
          ],
          "yAxes": [
            {"label": "Bytes/sec", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
        },
        {
          "id": 4,
          "title": "Pool Storage Growth Trend",
          "type": "graph",
          "targets": [
            {
              "expr": "ceph_pool_stored_bytes",
              "legendFormat": "{{pool_name}} Used"
            },
            {
              "expr": "predict_linear(ceph_pool_stored_bytes[6h], 86400)",
              "legendFormat": "{{pool_name}} Predicted +24h"
            }
          ],
          "yAxes": [
            {"label": "Bytes", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16}
        },
        {
          "id": 5,
          "title": "Pool Utilization %",
          "type": "graph",
          "targets": [
            {
              "expr": "(ceph_pool_stored_bytes / ceph_pool_quota_max_bytes) * 100",
              "legendFormat": "{{pool_name}} Utilization"
            }
          ],
          "yAxes": [
            {"label": "Percent", "max": 100, "min": 0, "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}
        },
        {
          "id": 6,
          "title": "Pool Object Distribution",
          "type": "graph",
          "targets": [
            {
              "expr": "ceph_pool_objects",
              "legendFormat": "{{pool_name}} Objects"
            }
          ],
          "yAxes": [
            {"label": "Object Count", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24}
        },
        {
          "id": 7,
          "title": "Pool PG Distribution",
          "type": "graph",
          "targets": [
            {
              "expr": "ceph_pool_pg_num",
              "legendFormat": "{{pool_name}} PGs"
            },
            {
              "expr": "ceph_pool_pgp_num",
              "legendFormat": "{{pool_name}} PGPs"
            }
          ],
          "yAxes": [
            {"label": "PG Count", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 24}
        },
        {
          "id": 8,
          "title": "Pool Compression Efficiency",
          "type": "graph",
          "targets": [
            {
              "expr": "ceph_pool_compress_bytes_used",
              "legendFormat": "{{pool_name}} Compressed"
            },
            {
              "expr": "ceph_pool_compress_under_bytes",
              "legendFormat": "{{pool_name}} Uncompressed"
            },
            {
              "expr": "ceph_pool_compress_bytes_used / ceph_pool_compress_under_bytes",
              "legendFormat": "{{pool_name}} Ratio"
            }
          ],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32}
        },
        {
          "id": 9,
          "title": "Pool Recovery Status",
          "type": "graph",
          "targets": [
            {
              "expr": "ceph_pool_recovering_objects_per_sec",
              "legendFormat": "{{pool_name}} Recovery Obj/s"
            },
            {
              "expr": "ceph_pool_recovering_bytes_per_sec",
              "legendFormat": "{{pool_name}} Recovery MB/s"
            }
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32}
        },
        {
          "id": 10,
          "title": "Pool Application Usage",
          "type": "piechart",
          "targets": [
            {
              "expr": "ceph_pool_stored_bytes{pool_name=~\".*rbd.*\"}",
              "legendFormat": "RBD Pools"
            },
            {
              "expr": "ceph_pool_stored_bytes{pool_name=~\".*rgw.*\"}",
              "legendFormat": "RGW Pools"
            },
            {
              "expr": "ceph_pool_stored_bytes{pool_name=~\".*cephfs.*\"}",
              "legendFormat": "CephFS Pools"
            }
          ],
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 40}
        },
        {
          "id": 11,
          "title": "Pool Error Rates",
          "type": "graph",
          "targets": [
            {
              "expr": "ceph_pool_scrub_errors",
              "legendFormat": "{{pool_name}} Scrub Errors"
            },
            {
              "expr": "ceph_pool_deep_scrub_errors",
              "legendFormat": "{{pool_name}} Deep Scrub Errors"
            }
          ],
          "yAxes": [
            {"label": "Error Count", "show": true},
            {"show": false}
          ],
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 40}
        }
      ],
      "time": {"from": "now-6h", "to": "now"},
      "refresh": "1m"
    }
  folder: Ceph
  instanceSelector:
    matchLabels:
      app: grafana
  resyncPeriod: 10m
