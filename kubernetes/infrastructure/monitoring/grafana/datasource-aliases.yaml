# ðŸŽ¯ ENTERPRISE DATASOURCE ALIASES - Eliminates hardcoded references
# Solves dashboard import issues without complex jobs or RBAC

---
# Common alias for legacy Prometheus references
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: prometheus-legacy-alias
  namespace: monitoring
  labels:
    app.kubernetes.io/name: prometheus-legacy-alias
    app.kubernetes.io/part-of: grafana
    datasource-purpose: "legacy-compatibility"
spec:
  instanceSelector:
    matchLabels:
      dashboards: "grafana"
  datasource:
    name: Prometheus  # Matches old dashboard expectations
    type: prometheus
    access: proxy
    url: http://vmselect-vmcluster.monitoring.svc.cluster.local:8481/select/0/prometheus
    isDefault: false
    editable: false
    jsonData:
      timeInterval: "30s"
      queryTimeout: "60s"
      httpMethod: "POST"

---
# VictoriaMetrics specific alias patterns
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: victoriametrics-variable-alias
  namespace: monitoring
  labels:
    app.kubernetes.io/name: victoriametrics-variable-alias
    app.kubernetes.io/part-of: grafana
    datasource-purpose: "variable-compatibility"
spec:
  instanceSelector:
    matchLabels:
      dashboards: "grafana"
  datasource:
    name: DS__VICTORIAMETRICS  # Matches failed imports from your log
    type: prometheus
    access: proxy
    url: http://vmselect-vmcluster.monitoring.svc.cluster.local:8481/select/0/prometheus
    isDefault: false
    editable: false
    jsonData:
      timeInterval: "30s"
      queryTimeout: "60s"
      httpMethod: "POST"

---
# Production VictoriaMetrics alias
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: victoriametrics-prod-alias
  namespace: monitoring
  labels:
    app.kubernetes.io/name: victoriametrics-prod-alias
    app.kubernetes.io/part-of: grafana
    datasource-purpose: "production-alias"
spec:
  instanceSelector:
    matchLabels:
      dashboards: "grafana"
  datasource:
    name: DS__VICTORIAMETRICS-PROD-ALL  # Matches failed import from your log
    type: prometheus
    access: proxy
    url: http://vmselect-vmcluster.monitoring.svc.cluster.local:8481/select/0/prometheus
    isDefault: false
    editable: false
    jsonData:
      timeInterval: "30s"
      queryTimeout: "60s"
      httpMethod: "POST"
