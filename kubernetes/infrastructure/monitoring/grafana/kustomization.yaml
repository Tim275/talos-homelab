apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# : Parent manages namespaces, children inherit
# Namespace managed by: monitoring/namespace.yaml (parent app)
namespace: grafana

resources:
  - grafana.yaml                           # Grafana Operator CR (manages Grafana instance)
  # - grafana-operator-dashboard.yaml      # DISABLED: File doesn't exist
  - http-route.yaml                        # ENABLED: HTTPS access via Envoy Gateway (Port 443)
  - http-route-http.yaml                   # ENABLED: HTTP access for Cloudflare Tunnel (Port 80)
  # - admin-credentials.yaml          # DISABLED: SealedSecret decryption failing
  # - oidc-credentials.yaml           # DISABLED: SealedSecret decryption failing
  - elasticsearch-credentials.yaml    # ELASTICSEARCH: Basic auth credentials
  - datasources/alertmanager-operated.yaml
  - datasources/prometheus-operated.yaml
  # Removed prometheus-grafanacom.yaml - use default Prometheus datasource
  - datasources/loki.yaml
  - datasources/tempo.yaml            # TEMPO: Distributed tracing datasource
  - datasources/elasticsearch.yaml    # ELASTICSEARCH: Production cluster datasource

  # TIER 0 EXECUTIVE DASHBOARDS - Enterprise SRE Overview
  - enterprise-dashboards/tier0-executive/k8s-global-view.yaml
  - enterprise-dashboards/tier0-executive/node-system-overview.yaml

  # ARGOCD - GitOps Deployment
  - enterprise-dashboards/argocd/argocd-gitops.yaml
  - enterprise-dashboards/argocd/official-argocd-operational.yaml      # Official Grafana.com dashboard (ID: 19993)
  - enterprise-dashboards/argocd/official-argocd-application.yaml      # Official Grafana.com dashboard (ID: 19974)
  - enterprise-dashboards/argocd/official-argocd-notifications.yaml    # Official Grafana.com dashboard (ID: 19975)
  - enterprise-dashboards/argocd/official-argocd-overview-v3.yaml      # Official Grafana.com dashboard (ID: 24192)
  - enterprise-dashboards/argocd/official-argocd-basic.yaml            # Official Grafana.com dashboard (ID: 14584)

  # CEPH - Storage
  # - enterprise-dashboards/ceph/rook-ceph-storage.yaml                # DISABLED: Custom dashboard with JavaScript errors
  - enterprise-dashboards/ceph/official-ceph-cluster.yaml              # Official Grafana.com dashboard (ID: 2842)
  - enterprise-dashboards/ceph/official-ceph-pools.yaml                # Official Grafana.com dashboard (ID: 5342)
  - enterprise-dashboards/ceph/official-ceph-osd.yaml                  # Official Grafana.com dashboard (ID: 5336)

  # CERT-MANAGER - Certificate Management
  # - enterprise-dashboards/cert-manager/cert-manager-status.yaml      # DISABLED: Custom dashboard with JavaScript errors
  - enterprise-dashboards/cert-manager/official-cert-manager.yaml      # Official Grafana.com dashboard (ID: 20842)

  # CILIUM - Networking & Security
  - enterprise-dashboards/cilium/official-cilium-agent.yaml            # Official Grafana.com dashboard (ID: 16611)
  - enterprise-dashboards/cilium/official-cilium-operator.yaml         # Official Grafana.com dashboard (ID: 16612)
  - enterprise-dashboards/cilium/official-hubble.yaml                  # Official Grafana.com dashboard (ID: 16613)

  # ELASTICSEARCH - Search & Analytics
  # - enterprise-dashboards/elasticsearch/elasticsearch-cluster.yaml    # DISABLED: Custom dashboard with JavaScript errors
  - enterprise-dashboards/elasticsearch/official-elasticsearch-overview.yaml # Official Grafana.com dashboard (ID: 14191)
  - enterprise-dashboards/elasticsearch/official-elasticsearch-xpack.yaml   # Official Grafana.com dashboard (ID: 8642)
  - enterprise-dashboards/elasticsearch/official-kibana-monitoring.yaml     # Official Grafana.com dashboard (ID: 21420)

  # ENVOY - Gateway & Proxy
  - enterprise-dashboards/envoy/official-envoy-proxy.yaml              # Official Grafana.com dashboard (ID: 6693)
  - enterprise-dashboards/envoy/official-envoy-global.yaml             # Official Grafana.com dashboard (ID: 11022)

  # GRAFANA - Monitoring Platform
  - enterprise-dashboards/grafana/official-grafana-operator.yaml       # Official Grafana.com dashboard (ID: 22785)

  # GOLANG - Microservices Runtime Monitoring
  - enterprise-dashboards/golang/official-go-runtime-metrics.yaml      # Official Grafana.com dashboard (ID: 14061)
  - enterprise-dashboards/golang/official-golang-metrics.yaml          # Official Grafana.com dashboard (ID: 13076)

  # GPU & ML - NVIDIA CUDA / Machine Learning
  - enterprise-dashboards/gpu/official-nvidia-dcgm.yaml                # Official Grafana.com dashboard (ID: 12239)
  - enterprise-dashboards/gpu/official-nvidia-dcgm-mig.yaml            # Official Grafana.com dashboard (ID: 23382)

  # INFLUXDB - Time Series Database
  - enterprise-dashboards/influxdb/official-influxdb-metrics.yaml      # Official Grafana.com dashboard (ID: 13315)

  # ISTIO - Service Mesh
  - enterprise-dashboards/istio/official-istio-mesh.yaml               # Official Grafana.com dashboard (ID: 7639)
  - enterprise-dashboards/istio/official-istio-service.yaml            # Official Grafana.com dashboard (ID: 7636)
  - enterprise-dashboards/istio/official-istio-control-plane.yaml      # Official Grafana.com dashboard (ID: 7645)
  - enterprise-dashboards/istio/official-istio-performance.yaml        # Official Grafana.com dashboard (ID: 11829)
  - enterprise-dashboards/istio/official-istio-workload.yaml           # Official Grafana.com dashboard (ID: 7630)

  # KAFKA - Event Streaming
  - enterprise-dashboards/kafka/kafka-strimzi.yaml
  - enterprise-dashboards/kafka/strimzi-kafka-cluster.yaml             # Strimzi-compatible cluster metrics (replaces ID: 14505)
  - enterprise-dashboards/kafka/official-kafka-exporter.yaml           # Official Grafana.com dashboard (ID: 7589)
  - enterprise-dashboards/kafka/official-kafka-cluster.yaml            # Dashboard 1: Cluster Overview (ID: 14505)
  - enterprise-dashboards/kafka/official-kafka-topics.yaml             # Dashboard 3: Topic Details (ID: 14506)
  - enterprise-dashboards/kafka/kafka-consumer-performance.yaml        # Dashboard 2: Consumer Lag & Performance
  - enterprise-dashboards/kafka/kafka-application-metrics.yaml         # Dashboard 4: Application Metrics (Producer/Consumer)
  - enterprise-dashboards/kafka/kafka-data-pipeline.yaml               # Dashboard 5: Data Pipeline & E2E Latency
  - enterprise-dashboards/kafka/spring-boot-kafka-apps.yaml            # JVM Micrometer (ID: 4701) - Spring Boot Kafka Apps
  - enterprise-dashboards/kafka/kafka-spring-producer-consumer.yaml    # Kafka Producer/Consumer Metrics (ID: 18276)
  - enterprise-dashboards/kafka/spring-kafka-microservices.yaml        # Spring Kafka Microservices (custom, works with actual metrics)

  # KUBERNETES - Control Plane & System Monitoring
  - enterprise-dashboards/kubernetes/k8s-api-server.yaml               # Official Grafana.com dashboard (ID: 15761)
  - enterprise-dashboards/kubernetes/k8s-coredns.yaml                  # Official Grafana.com dashboard (ID: 15762)
  - enterprise-dashboards/kubernetes/k8s-views-global.yaml             # Official Grafana.com dashboard (ID: 15757)
  - enterprise-dashboards/kubernetes/k8s-views-namespaces.yaml         # Official Grafana.com dashboard (ID: 15758)
  - enterprise-dashboards/kubernetes/k8s-views-nodes.yaml              # Official Grafana.com dashboard (ID: 15759)
  - enterprise-dashboards/kubernetes/k8s-views-pods.yaml               # Official Grafana.com dashboard (ID: 15760)
  - enterprise-dashboards/kubernetes/k8s-scheduler.yaml                # Official Grafana.com dashboard (ID: 12130)
  - enterprise-dashboards/kubernetes/k8s-controller-manager.yaml       # Official Grafana.com dashboard (ID: 12122)
  - enterprise-dashboards/kubernetes/k8s-etcd.yaml                     # Official Grafana.com dashboard (ID: 20330)
  - enterprise-dashboards/kubernetes/k8s-persistent-volumes.yaml       # Official Grafana.com dashboard (ID: 13646)
  - enterprise-dashboards/kubernetes/k8s-state-metrics-v2.yaml         # Official Grafana.com dashboard (ID: 21742)

  # LOKI - Log Aggregation
  - enterprise-dashboards/loki/loki-logging.yaml
  - enterprise-dashboards/loki/official-loki-stack.yaml                # Official Grafana.com dashboard (ID: 14055)
  - enterprise-dashboards/loki/official-loki-dashboard.yaml            # Official Grafana.com dashboard (ID: 13186)
  - enterprise-dashboards/loki/official-loki-logs.yaml                 # Official Grafana.com dashboard (ID: 15324)
  - enterprise-dashboards/loki/official-loki-logging.yaml              # Official Grafana.com dashboard (ID: 12611)
  # - enterprise-dashboards/loki/official-loki-metrics.yaml            # DISABLED: Too large (>262KB annotations limit)

  # OPENTELEMETRY - Observability
  - enterprise-dashboards/opentelemetry/official-opentelemetry-collector.yaml  # Official Grafana.com dashboard (ID: 15983)
  - enterprise-dashboards/opentelemetry/official-opentelemetry-dataflow.yaml   # Official Grafana.com dashboard (ID: 18309)
  - enterprise-dashboards/opentelemetry/official-opentelemetry-apm.yaml        # Official Grafana.com dashboard (ID: 19419)

  # POSTGRESQL - Database
  - enterprise-dashboards/postgresql/postgresql-cnpg.yaml
  - enterprise-dashboards/postgresql/official-cloudnativepg.yaml       # Official CNPG dashboard (252KB, 66 panels)

  # PROMETHEUS - Monitoring
  - enterprise-dashboards/prometheus/prometheus-targets-health.yaml

  # REDIS - Cache & Message Broker
  - enterprise-dashboards/redis/redis-clusters.yaml
  - enterprise-dashboards/redis/official-redis-operator.yaml           # Official Grafana.com dashboard (ID: 12165)

  # SECURITY - Runtime Security & eBPF Observability
  # - enterprise-dashboards/security/official-tetragon-kubectl-exec.yaml # DISABLED: Tetragon removed from cluster
  - enterprise-dashboards/security/official-falco-security.yaml        # Official Grafana.com dashboard (ID: 11914)

  # SLO & RELIABILITY - Service Level Objectives
  - enterprise-dashboards/slo/official-service-level-sli-slo.yaml      # Official Grafana.com dashboard (ID: 8793)
  - enterprise-dashboards/slo/official-slo-dashboard.yaml              # Official Grafana.com dashboard (ID: 11222)

  # VELERO - Backup & Disaster Recovery
  - enterprise-dashboards/velero/official-velero-stats.yaml            # Official Grafana.com dashboard (ID: 11055)
  - enterprise-dashboards/velero/official-velero-exporter.yaml         # Official Grafana.com dashboard (ID: 15469)

  # OMS - Order Management System Microservices
  - enterprise-dashboards/oms/oms-overview.yaml
  - enterprise-dashboards/oms/oms-gateway.yaml
  - enterprise-dashboards/oms/oms-orders.yaml
  - enterprise-dashboards/oms/oms-stock.yaml
  - enterprise-dashboards/oms/oms-payments.yaml
  - enterprise-dashboards/oms/oms-kitchen.yaml

# REMOVED: grafana-operator moved to separate infrastructure-grafana-operator application
# This prevents duplicate CRD conflicts with grafana-operator/ directory
# helmCharts:
#   - name: grafana-operator
#     repo: oci://ghcr.io/grafana/helm-charts
#     includeCRDs: true
#     namespace: grafana
#     version: v5.20.0 # renovate: github-releases=grafana/grafana-operator
#     releaseName: grafana-operator
#     valuesFile: ./values.yaml
