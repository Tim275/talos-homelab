apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization


# Cache-bust comment to force fresh ArgoCD repo download: $(date +%s)
resources:
  - ns.yaml
  - grafana.yaml
  # - grafana-operator-dashboard.yaml      # ‚ùå DISABLED: File doesn't exist
  - http-route.yaml                        # ‚úÖ ENABLED: HTTPS access via Envoy Gateway (Port 443)
  - http-route-http.yaml                   # ‚úÖ ENABLED: HTTP access for Cloudflare Tunnel (Port 80)
  # - admin-credentials.yaml          # ‚ùå DISABLED: SealedSecret decryption failing
  # - oidc-credentials.yaml           # ‚ùå DISABLED: SealedSecret decryption failing
  - datasources/alertmanager-operated.yaml
  - datasources/prometheus-operated.yaml
  - datasources/prometheus-grafanacom.yaml
  - datasources/loki.yaml

  # üìä WORKING DASHBOARD CONFIGMAPS - These have actual dashboard JSON content
  - dashboards/storage/rook-ceph-configmap.yaml
  - dashboards/infrastructure/argocd-gitops-configmap.yaml
  - dashboards/infrastructure/cert-manager-ssl-configmap.yaml
  - dashboards/infrastructure/cilium-network-configmap.yaml
  - dashboards/infrastructure/envoy-gateway-configmap.yaml
  - dashboards/infrastructure/talos-kubernetes-configmap.yaml
  - dashboards/platform/elasticsearch-configmap.yaml
  - dashboards/platform/kafka-streaming-configmap.yaml
  - dashboards/platform/cnpg-postgresql-configmap.yaml

  # üìä TIER 0 EXECUTIVE DASHBOARDS - Enterprise Overview (Custom JSON, Cross-Namespace)
  - dashboards/tier0-executive/kubernetes-global-view-configmap.yaml
  - dashboards/tier0-executive/prometheus-targets-health-configmap.yaml
  - dashboards/tier0-executive/cert-manager-status-configmap.yaml
  - dashboards/tier0-executive/node-system-overview-configmap.yaml

# ‚ùå REMOVED: grafana-operator moved to separate infrastructure-grafana-operator application
# This prevents duplicate CRD conflicts with grafana-operator/ directory
# helmCharts:
#   - name: grafana-operator
#     repo: oci://ghcr.io/grafana/helm-charts
#     includeCRDs: true
#     namespace: grafana
#     version: v5.19.1 # renovate: github-releases=grafana/grafana-operator
#     releaseName: grafana-operator
#     valuesFile: ./values.yaml
