apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: n8n-dev
  namespace: grafana
  labels:
    app: n8n
    environment: development
spec:
  instanceSelector:
    matchLabels:
      app: grafana
  folder: "üì± Applications"
  datasources:
    - inputName: "DS_PROMETHEUS"
      datasourceName: "Prometheus"
    - inputName: "DS_POSTGRESQL"
      datasourceName: "PostgreSQL"
  json: |
    {
      "title": "N8N Development - Queue Mode Monitoring",
      "uid": "n8n-dev-queue",
      "tags": ["n8n", "development", "queue", "workflows"],
      "timezone": "Europe/Berlin",
      "editable": true,
      "graphTooltip": 1,
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "refresh": "30s",
      "panels": [
        {
          "type": "stat",
          "title": "üü° N8N Dev Status",
          "gridPos": {"h": 3, "w": 3, "x": 0, "y": 0},
          "targets": [{
            "expr": "sum(up{namespace=\"n8n-dev\",job=\"n8n\"})",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "mappings": [{
                "type": "value",
                "options": {
                  "0": {"text": "‚ùå DOWN", "color": "red"},
                  "1": {"text": "‚úÖ UP", "color": "yellow"}
                }
              }],
              "thresholds": {
                "steps": [{"color": "yellow", "value": null}]
              }
            }
          },
          "options": {
            "colorMode": "value",
            "textMode": "value"
          }
        },
        {
          "type": "stat",
          "title": "N8N Version",
          "gridPos": {"h": 3, "w": 4, "x": 3, "y": 0},
          "targets": [{
            "expr": "max by (version) (n8n_version_info{namespace=\"n8n-dev\"})",
            "legendFormat": "{{version}}",
            "refId": "A"
          }],
          "options": {
            "colorMode": "value",
            "textMode": "name"
          }
        },
        {
          "type": "stat",
          "title": "üíæ Memory Usage",
          "gridPos": {"h": 3, "w": 4, "x": 7, "y": 0},
          "targets": [{
            "expr": "sum(n8n_process_resident_memory_bytes{namespace=\"n8n-dev\"})",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "unit": "bytes",
              "thresholds": {
                "steps": [
                  {"color": "green", "value": null},
                  {"color": "yellow", "value": 500000000},
                  {"color": "red", "value": 1000000000}
                ]
              }
            }
          },
          "options": {
            "colorMode": "value",
            "graphMode": "area"
          }
        },
        {
          "type": "stat",
          "title": "‚è±Ô∏è Uptime",
          "gridPos": {"h": 3, "w": 4, "x": 11, "y": 0},
          "targets": [{
            "expr": "time() - max(n8n_process_start_time_seconds{namespace=\"n8n-dev\"})",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "unit": "s"
            }
          },
          "options": {
            "colorMode": "value"
          }
        },
        {
          "type": "stat",
          "title": "üìä Queue Waiting",
          "gridPos": {"h": 3, "w": 3, "x": 15, "y": 0},
          "targets": [{
            "expr": "sum(n8n_scaling_mode_queue_jobs_waiting{namespace=\"n8n-dev\"}) or on() vector(0)",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "steps": [
                  {"color": "green", "value": null},
                  {"color": "yellow", "value": 10},
                  {"color": "red", "value": 50}
                ]
              }
            }
          },
          "options": {
            "colorMode": "value"
          }
        },
        {
          "type": "stat",
          "title": "‚ö° Queue Active",
          "gridPos": {"h": 3, "w": 3, "x": 18, "y": 0},
          "targets": [{
            "expr": "sum(n8n_scaling_mode_queue_jobs_active{namespace=\"n8n-dev\"}) or on() vector(0)",
            "refId": "A"
          }],
          "options": {
            "colorMode": "value"
          }
        },
        {
          "type": "timeseries",
          "title": "üöÄ Throughput (Jobs Completed/s) - Last Hour",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 3},
          "targets": [{
            "expr": "sum(rate(n8n_scaling_mode_queue_jobs_completed{namespace=\"n8n-dev\"}[5m])) or on() vector(0)",
            "legendFormat": "completed/s",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "custom": {
                "drawStyle": "line",
                "fillOpacity": 10
              }
            }
          }
        },
        {
          "type": "timeseries",
          "title": "‚ùå Error Rate (Jobs Failed/s) - Last Hour",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 3},
          "targets": [{
            "expr": "sum(rate(n8n_scaling_mode_queue_jobs_failed{namespace=\"n8n-dev\"}[5m])) or on() vector(0)",
            "legendFormat": "failed/s",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {
                "drawStyle": "line",
                "fillOpacity": 10
              }
            }
          }
        },
        {
          "type": "timeseries",
          "title": "üíª CPU Usage Rate (5m)",
          "gridPos": {"h": 6, "w": 24, "x": 0, "y": 11},
          "targets": [{
            "expr": "sum(rate(n8n_process_cpu_seconds_total{namespace=\"n8n-dev\"}[5m])) or on() vector(0)",
            "legendFormat": "cpu s/s",
            "refId": "A"
          }],
          "fieldConfig": {
            "defaults": {
              "unit": "s"
            }
          }
        }
      ]
    }
