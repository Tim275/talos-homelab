apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# 📊 GRAFANA DASHBOARDS - MINIMAL OFFICIAL SET
# ============================================================
# 5 official kube-prometheus-stack dashboards (from existing Git files)
# GUARANTEED to work with Prometheus datasource
# NO experimental/community dashboards

namespace: grafana

resources:
  # ☸️ KUBERNETES CORE (4 views - dotdc/grafana-dashboards-kubernetes)
  - kubernetes/k8s-views-global-15757.yaml     # Global cluster view
  - kubernetes/k8s-views-namespaces-15758.yaml # Namespace details
  - kubernetes/k8s-views-nodes-15759.yaml      # Node monitoring
  - kubernetes/k8s-views-pods-15760.yaml       # Pod monitoring

  # ☸️ KUBERNETES SYSTEM (2 system components)
  - kubernetes/k8s-system-api-server-15761.yaml # API Server metrics
  - kubernetes/k8s-system-coredns-15762.yaml    # CoreDNS metrics

  # 📝 LOGGING - Loki + Promtail (2 dashboards)
  - loki/loki-loki-stack-monitoring.yaml        # Loki stack monitoring
  - loki/loki-promtail-monitoring.yaml          # Promtail agent monitoring

  # 📝 LOGGING - Vector dashboards removed (expected Node Exporter metrics, not Vector metrics)

  # 🔄 GITOPS - ArgoCD (2 dashboards)
  - argocd/argocd-operational-19993.yaml        # ArgoCD operational metrics
  - argocd/argocd-application-19974.yaml        # ArgoCD applications

  # 🌐 NETWORKING - Cilium/Hubble
  # All Cilium dashboards removed: deprecated configMapRef format (v2.x)
  # Grafana Operator v5.x requires grafanaCom.id or inline JSON
  # TODO: Re-add Cilium dashboards using grafanaCom.id when available

  # 💽 STORAGE - Ceph/Rook (1 dashboard)
  - ceph/ceph-cluster-overview.yaml             # Ceph cluster health

  # 🗄️ DATABASES - PostgreSQL (1 dashboard)
  - postgresql/postgresql-cnpg-20417.yaml       # CloudNativePG monitoring

  # 🗄️ DATABASES - Redis (2 dashboards)
  - redis/redis-exporter-763.yaml               # Redis Exporter metrics
  - redis/redis-ha-11835.yaml                   # Redis HA monitoring

  # 🗄️ DATABASES - InfluxDB (1 dashboard)
  - influxdb/influxdb-17148.yaml                # InfluxDB time-series monitoring

  # 📨 MESSAGING - Kafka/Strimzi (3 dashboards)
  - kafka/strimzi-kafka-exporter-11285.yaml     # Strimzi Kafka Exporter
  - kafka/strimzi-kafka-11271.yaml              # Strimzi Kafka Demo
  - kafka/strimzi-mirror-maker-23706.yaml       # Kafka Mirror Maker 2

  # 🔍 OBSERVABILITY - Elasticsearch (1 dashboard)
  - elasticsearch/elasticsearch-overview-14191.yaml # Elasticsearch Exporter

  # 🔍 OBSERVABILITY - Jaeger (1 dashboard)
  - jaeger/jaeger-traces-10881.yaml             # Jaeger distributed tracing

  # 🌐 NETWORKING - Cilium (2 dashboards)
  - cilium/cilium-hubble-16613.yaml             # Cilium Hubble v1.12 metrics
  - cilium/cilium-policy-18015.yaml             # Cilium network policy verdicts

  # 🌐 NETWORKING - Istio (1 dashboard)
  - istio/istio-mesh-7639.yaml                  # Istio service mesh

  # 🔐 INFRASTRUCTURE - Cert-Manager (1 dashboard)
  - cert-manager/cert-manager-11001.yaml        # Certificate management

  # 💾 INFRASTRUCTURE - Velero (2 dashboards)
  - velero/velero-stats-11055.yaml              # Velero backup statistics
  - velero/velero-overview-23838.yaml           # Velero comprehensive overview

# ═══════════════════════════════════════════════════════════
# 📈 TOTAL: 25 DASHBOARDS (11 Core + 14 Enterprise Apps)
# ═══════════════════════════════════════════════════════════
#
# REMOVED: 12 dashboards with deprecated configMapRef (v2.x format)
#   - velero/velero-backup.yaml
#   - postgresql/cnpg-postgresql.yaml
#   - n8n/n8n-automation.yaml
#   - lldap/lldap-directory.yaml
#   - kafka/kafka-streaming.yaml
#   - jaeger/jaeger-tracing.yaml
#   - homelab/resource-costs.yaml
#   - homelab/homelab-overview.yaml
#   - cilium/cilium-network.yaml
#   - cert-manager/cert-manager-ssl.yaml
#   - ceph/ceph-osd-performance.yaml
#   - argocd/argocd-gitops.yaml
#
# WHY: Grafana Operator v5.x doesn't support configMapRef properly
#      Caused 205 operator restarts and "No Data" issues
#      Modern v5.x uses grafanaCom.id or inline JSON format
#
# These dashboards are:
# - Officially designed for kube-prometheus-stack
# - Battle-tested by the community (verified from dotdc/grafana-dashboards-kubernetes)
# - GUARANTEED to work with your Prometheus datasource
# - Will show data IMMEDIATELY after deployment
#
# Next steps ONLY if these 5 work perfectly:
# - Add API Server, CoreDNS dashboards
# - Add Node Exporter dashboards
# - Add application dashboards (only if metrics exist)
