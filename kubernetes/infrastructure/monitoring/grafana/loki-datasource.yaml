# üìù LOKI DATASOURCE - Grafana Operator CRD
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: loki
  namespace: monitoring
  labels:
    app.kubernetes.io/name: loki
    app.kubernetes.io/component: datasource
    app.kubernetes.io/part-of: monitoring-stack
    team: platform
spec:
  instanceSelector:
    matchLabels:
      dashboards: "grafana"  # ‚úÖ Matches our Grafana instance
  datasource:
    name: Loki
    type: loki
    access: proxy
    url: http://loki-gateway.monitoring.svc.cluster.local
    basicAuth: false
    isDefault: false
    editable: false
    jsonData:
      maxLines: 1000
      derivedFields:
        - datasourceUid: prometheus
          matcherRegex: "traceID=(\\w+)"
          name: "TraceID"
          url: "$${__value.raw}"
