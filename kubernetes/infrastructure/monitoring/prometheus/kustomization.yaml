apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# üåä Sync Wave 5: Prometheus Monitoring Stack (After Storage)
commonAnnotations:
  argocd.argoproj.io/sync-wave: "5"

resources:
  # üéØ LEVEL 3: COMPONENT CONTROL - Comment/Uncomment for fine-grained control
  # CRDs now managed by prometheus-operator-crds Helm chart
  - ../alert-rules-grafana/      # ‚úÖ ENABLED - Alerting rules (talos, kubernetes, production)

  # ‚ùå DISABLED ADVANCED CONFIGS - Uncomment when needed
  # - istio-monitoring.yaml     # ‚ùå Disabled - requires Istio integration
  # - kafka-monitoring.yaml     # ‚ùå Disabled - requires Kafka deployment
  # - kafka-metrics.yaml        # ‚ùå Disabled - requires Kafka metrics
# Namespace managed by parent monitoring app
# CRDs installed separately in ./crds to avoid annotation size issue
#
# ‚ö†Ô∏è  IMPORTANT: monitoring namespace requires privileged PodSecurity for node-exporter
# See TALOS_SECURITY.md for details and Talos Linux specific requirements

helmCharts:
  # üèóÔ∏è ENTERPRISE CRD MANAGEMENT (2025 Best Practice)
  - name: prometheus-operator-crds
    repo: https://prometheus-community.github.io/helm-charts
    version: "23.0.0" # Latest CRDs for v77.11.0 compatibility
    releaseName: prometheus-crds
    namespace: monitoring

  # ‚úÖ kube-prometheus-stack (main monitoring stack)
  - name: kube-prometheus-stack
    repo: https://prometheus-community.github.io/helm-charts
    version: "77.11.0" # renovate: helm=prometheus-community/kube-prometheus-stack
    releaseName: prometheus-operator
    namespace: monitoring
    valuesFile: values.yaml
    includeCRDs: false  # CRDs handled by separate prometheus-operator-crds chart
