
# üìä GRAFANA DATASOURCE - VictoriaMetrics Integration
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: victoriametrics-prometheus
  namespace: monitoring
  annotations:
    argocd.argoproj.io/sync-wave: "5"  # After VM Cluster
  labels:
    grafana_datasource: "victoriametrics"
    app.kubernetes.io/name: victoriametrics-datasource
    app.kubernetes.io/part-of: victoriametrics
spec:
  instanceSelector:
    matchLabels:
      dashboards: "grafana"  # Match Grafana instance selector

  datasource:
    name: VictoriaMetrics
    type: prometheus  # Prometheus-compatible!
    access: proxy
    url: http://vmselect-vm-cluster.monitoring.svc.cluster.local:8481/select/0/prometheus/

    # üéØ DEFAULT DATASOURCE (replace Prometheus)
    isDefault: true

    # üîß PROMETHEUS COMPATIBILITY
    jsonData:
      httpMethod: POST
      prometheusType: Prometheus
      prometheusVersion: "2.40.0"  # Compatible version

      # ‚ö° PERFORMANCE OPTIMIZATIONS
      queryTimeout: 300s
      timeInterval: "30s"

      # üè∑Ô∏è EXEMPLARS SUPPORT
      exemplarTraceIdDestinations:
        - datasourceUid: jaeger
          name: trace_id

    # üîí SECURITY (if needed)
    secureJsonData: {}
