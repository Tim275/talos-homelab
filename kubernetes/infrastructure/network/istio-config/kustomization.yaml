apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Istio Production Configuration for Order Management Microservices

namespace: istio-system

# Sync Wave 3 - After Istio Control Plane (wave 2)
commonAnnotations:
  argocd.argoproj.io/sync-wave: "3"

resources:
  # Security - mTLS & Zero Trust
  - peerauthentication-strict-mtls.yaml
  - authorizationpolicy-default-deny.yaml

  # Resilience - Circuit Breakers & Retries
  - destinationrule-circuit-breaker.yaml
  - virtualservice-retry-timeout.yaml

  # Observability - Tracing & Metrics
  - observability-telemetry.yaml

# Note: multi-tenant-isolation.yaml is NOT included in kustomization
# It contains example tenant namespaces that users should apply separately:
# kubectl apply -f multi-tenant-isolation.yaml

# Labels for all resources
commonLabels:
  app.kubernetes.io/name: istio-config
  app.kubernetes.io/component: service-mesh
  app.kubernetes.io/part-of: istio
  environment: production
