apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# ğŸ¢ TIER-0 ENTERPRISE PATTERN: Layer-based Infrastructure
# Netflix/Google/Meta/Amazon Pattern: Declarative resource composition
# namespace: argocd                     # âŒ DISABLED - Let components define their own namespaces

# ğŸŒŠ Sync Wave 1: Network Foundation Layer
commonAnnotations:
  argocd.argoproj.io/sync-wave: "1"

commonLabels:
  app.kubernetes.io/managed-by: argocd
  infrastructure.layer: network
  enterprise.tier: platform

# ğŸ¢ ENTERPRISE PATTERN: Kustomize-based resource composition (not ApplicationSets)
resources:
  - project.yaml

  # ğŸŒ Wave 0: Core Network Infrastructure
  - cilium
  - gateway

  # ğŸ” Wave 0-3: Service Mesh (Istio Ambient) - Separate Applications with Dependencies
  - istio-base-app.yaml        # Wave 0: Namespace + Base CRDs
  - istio-operator-app.yaml     # Wave 1: Sail Operator (Lifecycle Management)
  - istio-control-plane-app.yaml # Wave 2: Istio CR (after Operator CRDs)
  - istio-cni-app.yaml         # Wave 3: CNI
  - istio-gateway-app.yaml     # Wave 3: Gateway

  # ğŸŒ Wave 2: External Connectivity
  - cloudflared