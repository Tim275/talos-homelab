apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization


# ðŸŒŠ Sync Wave 2: Istio Control Plane (after Sail Operator CRDs)
# Note: Parent commonAnnotations will override, need to patch

namespace: istio-system

resources:
  - istio-control-plane.yaml
  - istiod-service-alias.yaml  # Service alias for ztunnel compatibility
  # - ztunnel.yaml  # DISABLED: Using Sidecar mode instead of Ambient
  - telemetry-config.yaml  # Istio Telemetry in istio-system
  - global-peer-authentication.yaml  # Global mTLS STRICT mode
  # ServiceMonitor moved to infrastructure/monitoring/servicemonitors/

patches:
  - target:
      kind: Istio
      name: default
    patch: |-
      - op: replace
        path: /metadata/annotations/argocd.argoproj.io~1sync-wave
        value: "2"
