apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: coturn

# ðŸŒŠ COTURN SYNC WAVE STRATEGY (Fine-Grained Control)
# Wave 0: Namespace + ConfigMaps (foundation)
# Wave 1: Certificate (cert-manager dependency - needs time to issue)
# Wave 2: Deployment + Service (after TLS ready)
#
# Note: Individual resource waves override this common annotation
commonAnnotations:
  argocd.argoproj.io/sync-wave: "0"  # Default for all resources

configMapGenerator:
  - name: turnserver-config
    files:
      - config/turnserver.conf
  - name: coturn-config
    literals:
      - LISTENING_IP="0.0.0.0"
      - LISTENING_PORT="3478"
      - TLS_LISTENING_PORT="5349"
      - REALM="coturn.timourhomelab.org"

resources:
  - ns.yaml
  - deployment.yaml
  - service.yaml
  - service-metrics.yaml
  - certificate.yaml
  # - netbird-credentials.yaml  # TODO: Create after Netbird setup
