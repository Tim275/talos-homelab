apiVersion: v1
kind: Service
metadata:
  name: coturn
  namespace: coturn
  labels:
    app: coturn
  annotations:
    # Cilium LoadBalancer IP assignment (LB-IPAM)
    io.cilium/lb-ipam-ips: "192.168.178.100"
    # Sync wave: after deployment ready
    argocd.argoproj.io/sync-wave: "2"
spec:
  type: LoadBalancer
  externalTrafficPolicy: Local  # Important for STUN (preserves source IP)
  selector:
    app: coturn
  ports:
    - name: stun-udp
      port: 3478
      protocol: UDP
      targetPort: 3478
    - name: stun-tcp
      port: 3478
      protocol: TCP
      targetPort: 3478
    - name: turn-tls
      port: 5349
      protocol: TCP
      targetPort: 5349
