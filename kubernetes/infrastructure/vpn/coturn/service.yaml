apiVersion: v1
kind: Service
metadata:
  name: coturn
  namespace: coturn
  labels:
    app: coturn
  annotations:
    # MetalLB static IP assignment
    metallb.universe.tf/loadBalancerIPs: "192.168.178.100"
spec:
  type: LoadBalancer
  externalTrafficPolicy: Local  # Important for STUN (preserves source IP)
  selector:
    app: coturn
  ports:
  - name: stun-udp
    port: 3478
    protocol: UDP
    targetPort: 3478
  - name: stun-tcp
    port: 3478
    protocol: TCP
    targetPort: 3478
  - name: turn-tls
    port: 5349
    protocol: TCP
    targetPort: 5349
---
apiVersion: v1
kind: Service
metadata:
  name: coturn-metrics
  namespace: coturn
  labels:
    app: coturn
spec:
  selector:
    app: coturn
  ports:
  - name: metrics
    port: 9641
    protocol: TCP
    targetPort: 9641
