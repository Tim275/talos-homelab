# üåê TAILSCALE CONNECTOR - SUBNET ROUTER
# ========================================
# Enterprise Tier-0 subnet routing via Tailscale Operator
#
# What it does:
#   - Advertises Kubernetes Pod CIDR (10.244.0.0/16) to Tailnet
#   - Advertises Kubernetes Service CIDR (10.96.0.0/16) to Tailnet
#   - Enables remote access to cluster services via Tailscale
#
# Architecture:
#   - Replicas: 2 (HA for production)
#   - Auto-approval: via tag:k8s in Tailscale ACL
#   - Managed by: Tailscale Operator
#
# Access Pattern:
#   MacBook (Tailscale) ‚Üí 10.244.x.y (Pod IP) ‚úÖ
#   MacBook (Tailscale) ‚Üí 10.96.x.y (Service IP) ‚úÖ
#   MacBook (Tailscale) ‚Üí 100.x.y.z (Connector IP) ‚úÖ
apiVersion: tailscale.com/v1alpha1
kind: Connector
metadata:
  name: k8s-subnet-router
  namespace: tailscale
  labels:
    app.kubernetes.io/name: tailscale-connector
    app.kubernetes.io/component: subnet-router
    enterprise.tier: infrastructure
    team: timour
spec:
  # HA configuration (2 replicas for redundancy)
  replicas: 2

  # Hostname in Tailscale admin console
  hostnamePrefix: talos-homelab-k8s

  # Subnet router configuration
  subnetRouter:
    advertiseRoutes:
      - "10.244.0.0/16"  # Cilium Pod CIDR
      - "10.96.0.0/16"   # Kubernetes Service CIDR

  # Tags for ACL-based auto-approval
  tags:
    - tag:k8s
