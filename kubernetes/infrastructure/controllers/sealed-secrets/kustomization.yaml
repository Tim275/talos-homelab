apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - namespace.yaml

# Sync Wave 0: Sealed Secrets Controller (FIRST - Bootstrap Layer) - Updated 2025-12-07
# Must deploy BEFORE any service that uses SealedSecrets (Cloudflared, Tailscale, Velero)
commonAnnotations:
  argocd.argoproj.io/sync-wave: "0"

namespace: sealed-secrets

# AUTOMATIC: TLS secret created by Terraform module automatically!
# Secret name: sealed-secrets-bootstrap-key (created by tofu/bootstrap/sealed-secrets)
# Uses persistent keys from: tofu/bootstrap/sealed-secrets/certificate/
# No manual steps needed - everything automated via Terraform! 

helmCharts:
  - name: sealed-secrets
    repo: https://bitnami-labs.github.io/sealed-secrets
    version: 2.18.3
    releaseName: sealed-secrets-controller
    namespace: sealed-secrets
    includeCRDs: true
    valuesFile: values.yaml
