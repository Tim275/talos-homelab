# Envoy Gateway Configuration for Talos Kubernetes
# Compatible with Gateway API v1.3.0

config:
  envoyGateway:
    # Gateway API compatibility
    gateway:
      controllerName: gateway.envoyproxy.io/gatewayclass-controller

    # Provider configuration for LoadBalancer support
    provider:
      type: Kubernetes
      kubernetes:
        envoyService:
          type: LoadBalancer
          # Use L2 announcement via Cilium LB-IPAM
          allocateLoadBalancerNodePorts: false
        envoyDeployment:
          replicas: 2
          # Resource limits for production
          container:
            resources:
              limits:
                cpu: 500m
                memory: 512Mi
              requests:
                cpu: 100m
                memory: 256Mi

    # Logging configuration
    logging:
      level:
        default: info

# Deployment configuration
deployment:
  replicas: 2

# Resources for the gateway controller
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 256Mi

# Service configuration
service:
  type: ClusterIP

# Enable Prometheus metrics
config:
  envoyGateway:
    telemetry:
      metrics:
        prometheus:
          endpoint: "0.0.0.0:8080"
        sinks:
        - type: Prometheus
          config:
            endpoint: "0.0.0.0:8080"