# Fluentd deployment as aggregator (receives from FluentBit)
# CRITICAL: Force deployment mode (not daemonset)
kind: Deployment
replicaCount: 2

# Official Fluentd image for deployment (not daemonset)
image:
  repository: fluent/fluentd
  tag: "v1.17-debian-1"

# Use default Fluentd configuration for now
# fluentdConf will be configured later after basic setup works

# Environment variables for Elasticsearch password
env:
  - name: ELASTICSEARCH_PASSWORD
    valueFrom:
      secretKeyRef:
        name: production-cluster-es-elastic-user
        key: elastic

# Resource limits for aggregator deployment
resources:
  limits:
    cpu: 200m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 256Mi

# Service for FluentBit to send logs to Fluentd
service:
  type: ClusterIP
  
# ServiceMonitor for Prometheus
serviceMonitor:
  enabled: true

# Deployment specific settings (not DaemonSet)
replicaCount: 2
autoscaling:
  enabled: false