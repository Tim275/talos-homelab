# Production Fluentd Deployment Configuration 
# Uses official fluentd image with Elasticsearch plugins
# Based on https://github.com/fluent/helm-charts/tree/main/charts/fluentd

replicaCount: 2

# Use official production image with Elasticsearch plugin
image:
  repository: fluent/fluentd-kubernetes-daemonset
  tag: "v1.19-debian-elasticsearch8-1"

# Environment variables for Elasticsearch connection
env:
  - name: FLUENT_ELASTICSEARCH_HOST
    value: "production-cluster-es-http.elastic-system"
  - name: FLUENT_ELASTICSEARCH_PORT  
    value: "9200"
  - name: FLUENT_ELASTICSEARCH_SCHEME
    value: "https"
  - name: FLUENT_ELASTICSEARCH_SSL_VERIFY
    value: "false"
  - name: FLUENT_ELASTICSEARCH_USER
    value: "elastic"
  - name: FLUENT_ELASTICSEARCH_PASSWORD
    valueFrom:
      secretKeyRef:
        name: production-cluster-es-elastic-user
        key: elastic

# Resource limits for production aggregator
resources:
  limits:
    cpu: 500m
    memory: 1Gi
  requests:
    cpu: 200m
    memory: 512Mi

# Service configuration for FluentBit
service:
  enabled: true
  type: ClusterIP
  ports:
    - name: forwarder
      protocol: TCP
      containerPort: 24224

# Use default DaemonSet configuration with environment variables

# Volume for buffers
volumeMounts:
  - name: buffer-storage
    mountPath: /buffers

volumes:
  - name: buffer-storage
    emptyDir: {}

# Service monitor for monitoring
serviceMonitor:
  enabled: true