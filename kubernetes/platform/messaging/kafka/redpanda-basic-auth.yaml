---
# SealedSecret mit htpasswd credentials (admin:kafka2024) - SHA format für Envoy
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: redpanda-basic-auth
  namespace: kafka
spec:
  encryptedData:
    .htpasswd: AgBeHIusx8VVk5dAHX+I8Tq3HmsZC2vcLAWtrcGRQy47k8rCz6d58H7/judQV0ZS+9/hUaED6+Odz/7d+9avjc4LlEzo83CLbc+Q6q/bTTI3LOj2TqQ40kRbcBN+xvCssuwXi4jx54fdkqNp/s5AHs7XPHLTf7kcOeRqcGFF2A191iLPXNL+yp/9lRzpbvfvVi8bs/R34i8yXUCRz42QrXsMgdF5pw/B+OpTTh4kX+4eZJqQagS0nFOGh+DVf/LF1bETJQN+YJ8nTvJlPlAamYDPJ3hv+n2mXtFQhT/yFxr2pQxm+DPG+352+xm8ngTEd6UHAb5Ew2rWYmnp3dxPiG4Dx6TIqspHLydkkJZiQGTnwuhwnzAekbziCtY4Vo6STalhnF8ICzytKNrWmf7pSzCwDOmQH0B8Joq4oWXi9UlnG//Bb6HcELJbqNdKjX0E+0srl+MEscUTDAkKguyLmpBVL4kytaZjf9s96BALrElCYJUn+DmxmLxVCNqjW9sSfpKnF3Oqv6/1QkSiwDG7qZVGoA2ic6BGYXJw7Q4OF3Oej/np355P2uKpEdTxeRHAgNyJTMXslyne/DOxGpi5r4xleW1TX7rWC1XsgeBXEon1nHyv2x1CWfUgU9NqjvjZYpnVRnI9QhPNl08JC67zTiEmTi4Q0wehJ9iNmEqDrK6cwIU6UTbRAl5JQ9ZUPrIW07Ew2tvI8mmiFx16nBebZ2ZAGn8pDHqaHLKujR57fAC9WhN8p+hdqD0=
  template:
    metadata:
      name: redpanda-basic-auth
      namespace: kafka
---
# SecurityPolicy für Basic Auth
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: SecurityPolicy
metadata:
  name: redpanda-basic-auth
  namespace: kafka
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: redpanda-console
  basicAuth:
    users:
      name: redpanda-basic-auth
---
# HTTPRoute für Redpanda Console
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: redpanda-console
  namespace: kafka
spec:
  parentRefs:
    - name: envoy-gateway
      namespace: gateway
      sectionName: https
  hostnames:
    - kafka.timourhomelab.org
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: redpanda-console
          port: 8080
