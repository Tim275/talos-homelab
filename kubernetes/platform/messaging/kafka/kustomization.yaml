apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization


# Sync Wave 12: Enterprise Messaging Platform (Kafka with Strimzi)
commonAnnotations:
  argocd.argoproj.io/sync-wave: "12"
  #  Enterprise Service Ownership (moved to annotations to prevent service selector pollution)
  enterprise.app.kubernetes.io/managed-by: argocd
  enterprise.app.kubernetes.io/part-of: timour-homelab
  enterprise.app.kubernetes.io/component: messaging-platform
  enterprise.team: timour
  enterprise.service-owner: timour
  enterprise.service-tier: platform

namespace: kafka

resources:
  # NOTE: Namespace managed by operators ArgoCD app (avoids SharedResourceWarning)
  - kafka-metrics-config.yaml
  # Kafka Custom Resources - deployed after operator (wave 12)
  - kafka-cluster.yaml
  - kafka-topic.yaml
  # mTLS Users for secure authentication
  - kafka-users.yaml
  # Kafka Workload Monitoring
  - kafka-exporter-service.yaml        # Kafka Exporter metrics Service
  - kafka-exporter-servicemonitor.yaml # Prometheus ServiceMonitor for Kafka Exporter
  - kafka-broker-podmonitor.yaml       # PodMonitor for Broker JMX metrics

# Optional patches for adding labels to Strimzi-managed services
# patches:
#   - target:
#       kind: Service
#       name: my-cluster-kafka-brokers
#     patch: |-
#       - op: add
#         path: /metadata/labels/app
#         value: kafka
#       - op: add
#         path: /metadata/labels/component
#         value: kafka-broker
#       - op: add
#         path: /metadata/labels/release
#         value: prometheus-operator
