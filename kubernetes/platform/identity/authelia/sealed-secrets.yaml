apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: authelia-secrets
  namespace: authelia
spec:
  template:
    metadata:
      name: authelia-secrets
      namespace: authelia
    type: Opaque
  encryptedData:
    # Generate and seal these secrets:
    #
    # 1. LDAP Password (from LLDAP admin password):
    #    echo -n "homelab-admin-2024" | base64
    #
    # 2. Session Secret (32+ chars):
    #    openssl rand -base64 32
    #
    # 3. Storage Encryption Key (32+ chars):
    #    openssl rand -base64 32
    #
    # 4. OIDC HMAC Secret (32+ chars):
    #    openssl rand -base64 32
    #
    # 5. JWT Secret (32+ chars):
    #    openssl rand -base64 32
    #
    # 6. Generate hashed OIDC client secrets:
    #    KUBERNETES_SECRET="k8s-$(openssl rand -hex 16)"
    #    ARGOCD_SECRET="argo-$(openssl rand -hex 16)"
    #
    #    # Hash the secrets using Authelia crypto command:
    #    docker run --rm -it authelia/authelia authelia crypto hash generate argon2
    #    # Use the generated hashes in configmap.yaml client_secret fields
    #
    # Create and seal:
    # kubectl create secret generic authelia-secrets \
    #   --from-literal=ldap-password="homelab-admin-2024" \
    #   --from-literal=session-secret="$(openssl rand -base64 32)" \
    #   --from-literal=storage-encryption-key="$(openssl rand -base64 32)" \
    #   --from-literal=oidc-hmac-secret="$(openssl rand -base64 32)" \
    #   --from-literal=jwt-secret="$(openssl rand -base64 32)" \
    #   --namespace=authelia --dry-run=client -o yaml \
    # | kubeseal -o yaml > sealed-secrets.yaml
    #
    # PLACEHOLDER VALUES (need to be replaced):
    ldap-password: "SEALED_SECRET_PLACEHOLDER_LDAP"
    session-secret: "SEALED_SECRET_PLACEHOLDER_SESSION"
    storage-encryption-key: "SEALED_SECRET_PLACEHOLDER_STORAGE"
    oidc-hmac-secret: "SEALED_SECRET_PLACEHOLDER_OIDC_HMAC"
    jwt-secret: "SEALED_SECRET_PLACEHOLDER_JWT"
    oidc-kubernetes-secret: "SEALED_SECRET_PLACEHOLDER_K8S"
    oidc-argocd-secret: "SEALED_SECRET_PLACEHOLDER_ARGO"