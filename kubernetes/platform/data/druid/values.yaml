# Druid Helm Chart - Minimal Working Config
image:
  repository: apache/druid
  tag: "30.0.1"

# ZooKeeper
zookeeper:
  enabled: true
  replicaCount: 1
  image:
    registry: docker.io
    repository: bitnamilegacy/zookeeper
    tag: "3.8.4-debian-12-r0"
  persistence:
    enabled: true
    storageClass: rook-ceph-block-enterprise
    size: 2Gi

# Disable built-in PostgreSQL (use CNPG)
postgresql:
  enabled: false

# External metadata
metadataStore:
  type: postgresql
  host: druid-postgres-rw.druid.svc
  port: 5432
  user: druid
  password: druid-metadata-2026

# Deep storage
deepStorage:
  type: local

# Extensions
configVars:
  druid_extensions_loadList: '["postgresql-metadata-storage", "druid-kafka-indexing-service", "druid-datasketches"]'
  druid_storage_type: local
  druid_storage_storageDirectory: /opt/druid/var/druid/segments

# Coordinator
coordinator:
  replicaCount: 1
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  persistence:
    enabled: true
    storageClass: rook-ceph-block-enterprise
    size: 5Gi
  config:
    DRUID_XMX: 384m
    DRUID_XMS: 384m
    druid_coordinator_asOverlord_enabled: "true"
    druid_coordinator_asOverlord_overlordService: druid/overlord

# Broker
broker:
  replicaCount: 1
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  config:
    DRUID_XMX: 256m
    DRUID_XMS: 256m

# Historical
historical:
  replicaCount: 1
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  persistence:
    enabled: true
    storageClass: rook-ceph-block-enterprise
    size: 10Gi
  config:
    DRUID_XMX: 256m
    DRUID_XMS: 256m

# Disable MiddleManager (causes schema issues)
middleManager:
  enabled: false

# Disable Indexer (causes schema issues)
indexer:
  enabled: false

# Router (UI)
router:
  replicaCount: 1
  resources:
    requests:
      cpu: 50m
      memory: 256Mi
    limits:
      cpu: 250m
      memory: 512Mi
  config:
    DRUID_XMX: 128m
    DRUID_XMS: 128m
    druid_router_managementProxy_enabled: "true"
