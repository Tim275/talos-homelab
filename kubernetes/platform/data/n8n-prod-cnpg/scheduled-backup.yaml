# Scheduled Barman Backup for N8N PostgreSQL
# Daily full backup at 2 AM with 30 days retention
apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
  name: n8n-postgres-daily-backup
  namespace: n8n-prod
  annotations:
    argocd.argoproj.io/sync-wave: "4"  # After cluster (wave 3)
spec:
  # Daily backup schedule (cron format)
  schedule: "0 2 * * *"  # Every day at 2 AM

  # Immediate backup after creation (for testing)
  immediate: true

  # Backup configuration
  backupOwnerReference: self
  cluster:
    name: n8n-postgres

  # Enterprise backup method: volumeSnapshot for fast recovery
  # Falls back to barmanObjectStore if snapshots not available
  method: barmanObjectStore
