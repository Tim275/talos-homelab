---
apiVersion: v1
kind: ConfigMap
metadata:
  name: boutique-db-init
  namespace: boutique
data:
  init.sql: |
    -- Shopping cart items table
    CREATE TABLE IF NOT EXISTS cart_items (
        id SERIAL PRIMARY KEY,
        user_id VARCHAR(255) NOT NULL,
        product_id VARCHAR(255) NOT NULL,
        quantity INTEGER NOT NULL DEFAULT 1,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );

    CREATE INDEX idx_cart_user_id ON cart_items(user_id);
    CREATE INDEX idx_cart_product_id ON cart_items(product_id);

    -- Insert sample products for testing
    INSERT INTO cart_items (user_id, product_id, quantity) VALUES
    ('demo-user', 'OLJCESPC7Z', 1),
    ('demo-user', '66VCHSJNUP', 2)
    ON CONFLICT DO NOTHING;
