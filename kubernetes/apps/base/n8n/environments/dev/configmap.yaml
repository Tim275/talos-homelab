apiVersion: v1
kind: ConfigMap
metadata:
  name: n8n-configmap
  namespace: n8n-dev
data:
  N8N_PORT: "3008"
  N8N_PROTOCOL: "https"
  N8N_SECURE_COOKIE: "false"
  N8N_HOST: "n8n-dev.timourhomelab.org"
  N8N_EDITOR_BASE_URL: "https://n8n-dev.timourhomelab.org"
  N8N_PROXY_HOPS: "1"
  WEBHOOK_URL: "https://n8n-dev.timourhomelab.org/"

  # Security: Enforce file permissions (Enterprise requirement)
  N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS: "true"

  # Prometheus Metrics - Enable monitoring
  N8N_METRICS: "true"
  N8N_METRICS_INCLUDE_QUEUE_METRICS: "true"
  N8N_METRICS_QUEUE_METRICS_INTERVAL: "30"

  # Push Backend (WebSocket fix)
  N8N_PUSH_BACKEND: "sse"

  # Database Configuration - PostgreSQL (CNPG cluster)
  DB_TYPE: "postgresdb"
  DB_POSTGRESDB_HOST: "n8n-postgres-rw.n8n-dev.svc.cluster.local"
  DB_POSTGRESDB_PORT: "5432"
  DB_POSTGRESDB_DATABASE: "n8n"
  DB_POSTGRESDB_USER: "n8n"

  # Alternative: SQLite (disabled for dev - use PostgreSQL)
  # DB_TYPE: "sqlite"
  # DB_SQLITE_DATABASE: "/home/node/.n8n/database.sqlite"
