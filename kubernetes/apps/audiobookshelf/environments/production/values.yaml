# 🏭 Production Configuration - Enterprise Media Platform
image:
  repository: ghcr.io/advplyr/audiobookshelf
  tag: "2.27.0"
  pullPolicy: IfNotPresent

service:
  main:
    ports:
      http:
        port: 8080

env:
  PORT: "8080"

persistence:
  config:
    enabled: true
    existingClaim: audiobookshelf-config
    mountPath: /config
  data:
    enabled: true
    existingClaim: audiobookshelf-data
    mountPath: /audiobooks
  metadata:
    enabled: true
    existingClaim: audiobookshelf-config
    mountPath: /metadata
    subPath: metadata

securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  runAsNonRoot: true

resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "1Gi"
    cpu: "1000m"

# 🛡️ Security - Production
podSecurityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  runAsNonRoot: true

# 🏭 Production Settings
replicaCount: 2

# 📊 High Availability
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - audiobookshelf
        topologyKey: kubernetes.io/hostname

# 📊 Monitoring
probes:
  liveness:
    enabled: true
    path: /
    periodSeconds: 30
  readiness:
    enabled: true
    path: /
    periodSeconds: 10
  startup:
    enabled: true
    path: /
    periodSeconds: 10
    failureThreshold: 30

# 🔔 Resource Management
tolerations: []
nodeSelector:
  node-role.kubernetes.io/worker: "true"