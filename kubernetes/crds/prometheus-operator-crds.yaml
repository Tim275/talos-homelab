---
# Essential Prometheus Operator CRDs that must be installed before monitoring applications
# These CRDs are required for monitoring-prometheus and monitoring-alert-rules-grafana to sync successfully
# Apply these manually before ArgoCD bootstrap: kubectl apply -f kubernetes/crds/prometheus-operator-crds.yaml

# AlertManager CRD (v0.65.0 - compatible with cluster annotation limits)
apiVersion: v1
kind: List
items:
- apiVersion: apiextensions.k8s.io/v1
  kind: CustomResourceDefinition
  metadata:
    annotations:
      controller-gen.kubebuilder.io/version: v0.7.0
    name: alertmanagers.monitoring.coreos.com
  spec:
    group: monitoring.coreos.com
    names:
      categories:
      - prometheus-operator
      kind: Alertmanager
      listKind: AlertmanagerList
      plural: alertmanagers
      singular: alertmanager
    scope: Namespaced
    versions:
    - name: v1
      schema:
        openAPIV3Schema:
          description: Alertmanager describes an Alertmanager cluster.
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values.'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this object represents.'
              type: string
            metadata:
              type: object
            spec:
              description: Specification of the desired behavior of the Alertmanager cluster.
              properties:
                replicas:
                  description: Size is the expected size of the alertmanager cluster.
                  format: int32
                  type: integer
              type: object
          type: object
      served: true
      storage: true

---
# AlertManagerConfig CRD
apiVersion: v1
kind: List
items:
- apiVersion: apiextensions.k8s.io/v1
  kind: CustomResourceDefinition
  metadata:
    annotations:
      controller-gen.kubebuilder.io/version: v0.7.0
    name: alertmanagerconfigs.monitoring.coreos.com
  spec:
    group: monitoring.coreos.com
    names:
      categories:
      - prometheus-operator
      kind: AlertmanagerConfig
      listKind: AlertmanagerConfigList
      plural: alertmanagerconfigs
      singular: alertmanagerconfig
    scope: Namespaced
    versions:
    - name: v1alpha1
      schema:
        openAPIV3Schema:
          description: AlertmanagerConfig defines a namespaced AlertManager config.
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation of an object.'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this object represents.'
              type: string
            metadata:
              type: object
            spec:
              description: AlertmanagerConfigSpec is a specification of the desired behavior of the AlertmanagerConfig.
              properties:
                route:
                  description: The Alertmanager route definition for alerts matching the resource's namespace.
                  type: object
              type: object
          type: object
      served: true
      storage: true

---
# PrometheusRule CRD - Required for Rook-Ceph alerts
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.7.0
  name: prometheusrules.monitoring.coreos.com
spec:
  group: monitoring.coreos.com
  names:
    categories:
    - prometheus-operator
    kind: PrometheusRule
    listKind: PrometheusRuleList
    plural: prometheusrules
    singular: prometheusrule
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        description: PrometheusRule defines recording and alerting rules for a Prometheus instance.
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation of an object.'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this object represents.'
            type: string
          metadata:
            type: object
          spec:
            description: Specification of desired alerting rule definitions for Prometheus.
            properties:
              groups:
                description: Content of Prometheus rule file
                type: array
                items:
                  type: object
                  properties:
                    name:
                      description: Name of the rule group
                      type: string
                    rules:
                      description: List of rules
                      type: array
                      items:
                        type: object
            type: object
        type: object
    served: true
    storage: true