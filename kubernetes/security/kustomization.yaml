# ğŸ¯ ENTERPRISE BOOTSTRAP PATTERN - 2-STEP CONTROL
# ===============================================
# STEP 1: BOOTSTRAP - kubectl apply -k security/
#         Deploys ONLY Projects + ApplicationSets (no individual services)
#         Fast bootstrap without waiting for Helm charts
#
# STEP 2: GRANULAR CONTROL - Comment/Uncomment in ApplicationSet files
#         Edit foundation-app.yaml, governance-app.yaml security ApplicationSets
#         Individual services ein/ausschalten nach Bootstrap
#
# RESULT: Every security service visible as individual Application in ArgoCD UI!

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

labels:
  - pairs:
      app.kubernetes.io/managed-by: argocd
      enterprise.tier: security
      enterprise.pattern: triple-level-control-2025
      team: timour

# ğŸŒŠ Sync Wave 0: Security Foundation (Before Everything)
commonAnnotations:
  argocd.argoproj.io/sync-wave: "0"

resources:
  # ğŸ›¡ï¸ SECURITY PROJECT
  - project.yaml

  # ğŸ›ï¸ LEVEL 1: DOMAIN CONTROL - Comment/Uncomment for extreme scenarios
  # ====================================================================

  # ğŸ¯ ENTERPRISE GITILES PATTERN - Pure Kustomize Control
  # ======================================================
  # Comment/Uncomment individual services for TRUE control

  # ğŸ›¡ï¸ FOUNDATION SECURITY (Comment/Uncomment individual services)
  - foundation/rbac/
  - foundation/pod-security/
  - foundation/network-policies/

  # ğŸ” RBAC AUTHORIZATION
  - rbac/                              # âœ… OIDC user/group mappings

  # ğŸ“‹ GOVERNANCE SECURITY (ApplicationSet for individual control)
  # - governance-app.yaml              # âŒ DISABLED: Kyverno webhook blocking all pods

  # ğŸ” RUNTIME SECURITY (Comment/Uncomment individual services)
  # - runtime/falco/                     # âŒ DISABLED - Runtime security not needed yet
  # - runtime/threat-detection/          # âŒ DISABLED - Not implemented yet
