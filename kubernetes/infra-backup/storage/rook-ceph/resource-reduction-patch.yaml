# Rook-Ceph Resource Reduction Patch for Homelab
# Dramatically reduce all Ceph component memory consumption

apiVersion: ceph.rook.io/v1
kind: CephCluster
metadata:
  name: rook-ceph
spec:
  resources:
    # Manager daemon - reduce from default
    mgr:
      requests:
        cpu: "100m"      # Reduced from 500m
        memory: "256Mi"   # Reduced from 1Gi
      limits:
        cpu: "200m"      # Reduced from 1000m
        memory: "400Mi"   # Reduced from 2Gi
    
    # Monitor daemons - reduce from default  
    mon:
      requests:
        cpu: "100m"      # Reduced from 200m
        memory: "256Mi"   # Reduced from 1Gi
      limits:
        cpu: "200m"      # Reduced from 500m
        memory: "400Mi"   # Reduced from 2Gi
    
    # OSD daemons - biggest memory hogs
    osd:
      requests:
        cpu: "200m"      # Reduced from 1000m
        memory: "256Mi"   # Reduced from 4Gi (!!)
      limits:
        cpu: "400m"      # Reduced from 2000m
        memory: "500Mi"   # Reduced from 8Gi (!!)
    
    # OSD preparation
    prepareosd:
      requests:
        cpu: "50m"       # Reduced from 500m
        memory: "100Mi"   # Reduced from 1Gi
      limits:
        cpu: "100m"      # Reduced from 1000m
        memory: "200Mi"   # Reduced from 2Gi
        
    # Crash collector
    crashcollector:
      requests:
        cpu: "25m"       # Reduced from 100m
        memory: "50Mi"    # Reduced from 256Mi
      limits:
        cpu: "50m"       # Reduced from 200m
        memory: "100Mi"   # Reduced from 512Mi