# Force Prometheus and heavy monitoring to remote nodes
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-node-affinity
  namespace: monitoring
data:
  affinity: |
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: location
            operator: In
            values:
            - remote
---
# Patch for Prometheus StatefulSet
apiVersion: monitoring.coreos.com/v1
kind: Prometheus
metadata:
  name: prometheus-operator-kube-p-prometheus
  namespace: monitoring
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: location
            operator: In
            values:
            - remote