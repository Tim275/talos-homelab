{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":rebaseStalePrs",
    ":dependencyDashboard",
    ":semanticCommits"
  ],
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "Renovate Dashboard ðŸ¤–",
  "terraform": {
    "fileMatch": [
      "\\.tf$",
      "\\.tofu$",
      "\\.tfvars$"
    ]
  },
  "kubernetes": {
    "fileMatch": [
      "kubernetes/.+\\.yaml$",
      "kubernetes/.+\\.yml$"
    ]
  },
  "kustomize": {
    "fileMatch": [
      "(^|/)kustomization\\.ya?ml(\\.j2)?$"
    ]
  },
  "customManagers": [
    {
      "customType": "regex",
      "description": "Update Talos versions in all Terraform files",
      "fileMatch": [
        "\\.tf$",
        "\\.tofu$", 
        "\\.tfvars$",
        "\\.tftpl$"
      ],
      "matchStrings": [
        "version\\s*=\\s*\"v?(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)\"",
        "talos_machine_config_version\\s*=\\s*\"v?(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)\""
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "siderolabs/talos",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Kubernetes versions",
      "fileMatch": [
        "\\.tf$",
        "\\.tofu$",
        "\\.tfvars$",
        "\\.tftpl$"
      ],
      "matchStrings": [
        "kubernetes_version\\s*=\\s*\"v?(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)\""
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "kubernetes/kubernetes",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Gateway API versions",
      "fileMatch": [
        "\\.tf$",
        "\\.tofu$",
        "\\.tfvars$",
        "\\.tftpl$"
      ],
      "matchStrings": [
        "gateway_api_version\\s*=\\s*\"v?(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)\""
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "kubernetes-sigs/gateway-api",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Velero AWS plugin images",
      "fileMatch": ["**/*.yaml"],
      "matchStrings": [
        "image:\\s*velero/velero-plugin-for-aws:v(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "vmware-tanzu/velero-plugin-for-aws",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update OpenTelemetry Collector image",
      "fileMatch": ["**/*.yaml"],
      "matchStrings": [
        "image:\\s*otel/opentelemetry-collector-contrib:(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases", 
      "depNameTemplate": "open-telemetry/opentelemetry-collector-contrib",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Grafana Promtail image",
      "fileMatch": ["**/*.yaml"],
      "matchStrings": [
        "image:\\s*grafana/promtail:(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "grafana/loki",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex", 
      "description": "Update Kube-vip image",
      "fileMatch": ["**/*.yaml"],
      "matchStrings": [
        "image:\\s*ghcr\\.io/kube-vip/kube-vip:v(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "kube-vip/kube-vip", 
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Cloudflared image", 
      "fileMatch": ["**/*.yaml"],
      "matchStrings": [
        "image:\\s*cloudflare/cloudflared:(?<currentValue>[0-9]{4}\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "cloudflare/cloudflared",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Rook Ceph image",
      "fileMatch": ["**/*.yaml"],
      "matchStrings": [
        "image:\\s*rook/ceph:v(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases", 
      "depNameTemplate": "rook/rook",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Ceph image",
      "fileMatch": ["**/*.yaml"],
      "matchStrings": [
        "image:\\s*quay\\.io/ceph/ceph:v(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "ceph/ceph",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update ALL Talos system extension images",
      "fileMatch": ["**/*.tftpl", "**/*.yaml"],
      "matchStrings": [
        "image:\\s*ghcr\\.io/siderolabs/(?<depName>[^:]+):(?<currentValue>[^\\s]+)"
      ],
      "datasourceTemplate": "docker"
    },
    {
      "customType": "regex",
      "description": "Update Cilium CLI image",
      "fileMatch": ["**/*.yaml"],
      "matchStrings": [
        "image:\\s*quay\\.io/cilium/cilium-cli:v(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "cilium/cilium-cli",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update ArgoCD installation URLs",
      "fileMatch": ["**/*.yaml", "**/*.sh"],
      "matchStrings": [
        "https://raw\\.githubusercontent\\.com/argoproj/argo-cd/v(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)/manifests/install\\.yaml"
      ],
      "datasourceTemplate": "github-releases", 
      "depNameTemplate": "argoproj/argo-cd",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Jaeger Operator URLs",
      "fileMatch": ["**/kustomization.yaml"],
      "matchStrings": [
        "https://github\\.com/jaegertracing/jaeger-operator/releases/download/v(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)/jaeger-operator\\.yaml"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "jaegertracing/jaeger-operator",
      "versioningTemplate": "semver"  
    },
    {
      "customType": "regex",
      "description": "Update Rook Ceph raw GitHub URLs",
      "fileMatch": ["**/kustomization.yaml"],
      "matchStrings": [
        "https://raw\\.githubusercontent\\.com/rook/rook/v(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)/deploy/examples/[^\\s]+\\.yaml"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "rook/rook",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Helm chart versions WITHOUT renovate comments", 
      "fileMatch": ["**/kustomization.yaml"],
      "matchStrings": [
        "version:\\s*[\"']?(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)[\"']?(?!.*#.*renovate)"
      ],
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex", 
      "description": "Update Helm chart versions WITH renovate comments",
      "fileMatch": ["**/kustomization.yaml"],
      "matchStrings": [
        "version:\\s*(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)[^\\n]*#\\s*renovate:\\s*github-releases=(?<depName>[^\\s]+)"
      ],
      "datasourceTemplate": "github-releases",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update Proxmox CSI plugin tag",
      "fileMatch": ["**/values.yaml"],
      "matchStrings": [
        "tag:\\s*v(?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "sergelogvinov/proxmox-csi-plugin",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Update ALL container images (catch-all)",
      "fileMatch": ["**/*.yaml", "**/*.tftpl"],
      "matchStrings": [
        "image:\\s*(?<depName>[^\\s:]+):(?<currentValue>[^\\s]+)"
      ],
      "datasourceTemplate": "docker"
    }
  ],
  "packageRules": [
    {
      "groupName": "Talos System",
      "matchPackageNames": [
        "siderolabs/talos",
        "siderolabs/**",
        "ghcr.io/siderolabs/**"
      ]
    },
    {
      "groupName": "Kubernetes Core",
      "matchPackageNames": [
        "kubernetes/kubernetes"
      ]
    },
    {
      "groupName": "Cilium Network",
      "matchPackageNames": [
        "cilium/**",
        "**/cilium**",
        "quay.io/cilium/**"
      ]
    },
    {
      "groupName": "ArgoCD",
      "matchPackageNames": [
        "**/argo-cd**",
        "argoproj/**"
      ]
    },
    {
      "groupName": "Monitoring Stack", 
      "matchPackageNames": [
        "prometheus-community/**",
        "grafana/**",
        "**/loki**",
        "**/promtail**",
        "**/jaeger**",
        "**/opentelemetry**",
        "open-telemetry/**"
      ]
    },
    {
      "groupName": "Storage & Backup",
      "matchPackageNames": [
        "**/longhorn**",
        "**/rook**",
        "**/ceph**",
        "**/velero**",
        "**/minio**",
        "sergelogvinov/proxmox-csi-plugin",
        "vmware-tanzu/velero-plugin-for-aws"
      ]
    },
    {
      "groupName": "Security & Secrets",
      "matchPackageNames": [
        "**/cert-manager**",
        "**/sealed-secrets**",
        "**/external-secrets**"
      ]
    },
    {
      "groupName": "Database Operators",
      "matchPackageNames": [
        "**/cloudnative-pg**",
        "**/postgresql**",
        "**/mongodb**"
      ]
    },
    {
      "groupName": "Network & Gateway",
      "matchPackageNames": [
        "**/cloudflare**",
        "**/kube-vip**",
        "kubernetes-sigs/gateway-api",
        "cloudflare/cloudflared",
        "kube-vip/kube-vip"
      ]
    },
    {
      "matchManagers": [
        "terraform"
      ],
      "matchDepTypes": [
        "provider",
        "required_provider"
      ],
      "groupName": "Terraform/OpenTofu Providers"
    },
    {
      "matchManagers": [
        "github-actions"
      ],
      "groupName": "GitHub Actions"
    }
  ]
}